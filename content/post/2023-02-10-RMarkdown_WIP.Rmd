---
title: "RMarkdown"
date: '2023-02-10'
slug: RMarkdown
categories:
  - extras
tags:
subtitle: ''
summary: ''
authors: [pommeranz]
lastmod: '`r Sys.Date()`'
featured: no
header:
  image: "/header/" #https://pxhere.com/de/photo/29 maybe this?
  caption: "[Courtesy of pxhere](https://pxhere.com/de/photo/29)"
projects: []
---

```{r knitr options, echo=FALSE}
knitr::opts_chunk$set(message = FALSE, warning = FALSE)
```

```{r include = FALSE}

numberFunc <- sample(1:20, 2, replace = T)
```

## Was ist RMarkdown?

RMarkdown ist ein Framework, welches es ermöglicht, die Arbeit mit Daten in der Programmiersprache R möglichst transparent darzustellen und in einem Dokument aufzubereiten.Der Nutzen dahinter liegt unter anderem in gut einsehbarer und reproduzierbarer Forschung, da man damit seinen Workflow erweitert erläutern und visualisieren kann. Mit hinterlegtem Quellcode können auch mögliche Fehler in der Datenaufbereitung und -verarbeitung transparent von außen einsehbar werden.


## RMarkdown-Datei erstellen

Um eine RMarkdown-Datei zu erstellen, muss man in RStudio oben links eine neue Datei erstellen, und dort RMarkdown auswählen. Nun sollte sich ein Fenster öffnen in dem man einige Angaben treffen kann. Die ersten drei Parameter sind dabei relativ selbsterklärend, der Titel des Markdown-Dokuments, das Datum der Erstellung sowie der Name der/des Autor*in des Dokuments. Das Output-Format hingegen bestimmt, in welcher Form das Dokument ausgegeben werden soll, PDF, Word oder Html. Diese Parameter lassen sich später aber noch anpassen.

<!-- Hier Bild einfügen -->

## RMarkdown und Pandoc

Die RMarkdown-Datei wird mit dem Knit-Button, welcher in der Leiste unterhalb des Dateifensters ist, zu einem Dokument nach vordefiniertem Format kompiliert. Dabei wird zuerst der R-Code ausgeführt und dann in ein normales Markdown-Dokument kompiliert, dies ist die Funktion von "knitr". Im Anschluss wird das Markdown-Dokument mit Pandoc zu einem fertigen Dokument im gewünschten Format kompiliert. Innerhalb dieses Ablaufs wird aus dem Rmd bspw. eine Homepage oder ein PDF.


## Aufbau des Dokuments

Eine RMarkdown-Datei enthält typischerweise einen **Head** und einen **Textkörper**, sowie **Code-Chunks/Code-Blöcke**.

Im Head des Dokuments befinden sich die Argumente die beim Erstellen übergeben wurden. Es gibt viele weitere Output-Möglichkeiten wie beispielsweise Powerpoint-Slides. Auf der [Seite von RStudio](https://rmarkdown.rstudio.com/lesson-9.html) gibt es eine Liste weiterer Optionen.

Im eigentlichen Textkörper steht einfacher Text, wie er auch hier steht. Manchmal sind im Text [Links]() gesetzt, oder auch *schiefgestellter* oder **fettgedruckter** Text, dies wird auch mit Markdown-Syntax umgesetzt.

Die Code Chunks sind das, was ein RMarkdown von einem "normalen" Markdown-Dokument unterscheidet. Mit ihnen lässt sich R-Code in ein Dokument einbauen und ausführen, womit man unter anderem Grafiken und Ergebnisse automatisch berechnen und darstellen lassen kann.

Wie diese Bestandteile im Detail funktionieren, wird im folgenden schrittweise aufgeklärt.


## Markdown Syntax

RMarkdown verwendet eine Syntax, die auf [Pandoc Markdown](https://pandoc.org/MANUAL.html#pandocs-markdown) basiert. Pandocs Markdown ist dabei ein Vermittler, der zwischen verschiedenen Markdownformaten übersetzen kann. Auch *Blockelemente* lassen sich in Markdown erstellen, womit man beispielsweise Codeblocks teilen kann, dazu ein Beispiel aus dem PsyBsc2-Kurs:

```
# Daten laden
load(url('https://pandar.netlify.app/post/fb22.rda'))  
```

Dies geht mit drei Backticks ` ``` ` die jeweils über und unter dem Codeabschnitt stehen


## Code Chunks

Mit Code Chunks, welche zuvor in Markdown rein visuell verwendet wurden, lässt sich R-Code in ein Dokument einbauen um Ergebnisse, Analysen und Grafiken dynamisch in einen Fließtext zu integrieren. Erstellt werden diese mit einem Codeblock und einem Zusatzargument, der die Programmiersprache des Blocks definiert.
```
```{r }⠀
R-Code
```⠀
```
Hier ein Beispiel basierend auf dem Fragebogendatensatz fb22.

```{r }
#Fragebogendaten aus PsyBsc2 laden
load(url('https://pandar.netlify.app/post/fb22.rda'))

#prüfen, ob n >= 30
length(na.omit(fb22$nerd[fb22$job==2])) #Student*innen mit Nebenjob
length(na.omit(fb22$nerd[fb22$job==1])) #Student*innen ohne Nebenjob

```

Es gibt auch Parameter, die unter anderem die Darstellung des Codes und der Ergebnisse beeinflussen.
Man kann dabei mit `{r echo=c (-ErsteZeile:-LetzteZeile)}` einzelne Zeilen und Abschnitte des Codes verstecken, etwa wie im Folgenden eine logische Abfrage, die einen passenden Text für jedes Ergebnis eines leveneTests ausgibt.

```{r echo=c(-2,-4:-7)}
#Prüfung der Homoskedastizität
library(car)
leveneTest(fb22$nerd[!is.na(fb22$nerd) & !is.na(fb22$job)] ~ as.factor(fb22$job[!is.na(fb22$nerd) & !is.na(fb22$job)]))

if (leveneTest(fb22$nerd[!is.na(fb22$nerd) & !is.na(fb22$job)] ~ as.factor(fb22$job[!is.na(fb22$nerd) & !is.na(fb22$job)]))[1,3] < 0.05){
  ausgabe <-("Die Homoskedastizitätsannahme wird verworfen, daher wird eine Welch-Korrektur genutzt. (Dieser Text wurde aus der logischen Abfrage erstellt)")
} else{
  ausgabe <- ("Die Homoskedastizität kann angenommen werden. (Dieser Text wurde aus der logischen Abfrage erstellt)")
}

```

`r ausgabe`

Und mit `{r results="hide"}` kann man verhindern, dass Ergebnisse, wie das vom leveneTest, überhaupt ausgegeben werden.

```{r results="hide"}
leveneTest(fb22$nerd[!is.na(fb22$nerd) & !is.na(fb22$job)] ~ as.factor(fb22$job[!is.na(fb22$nerd) & !is.na(fb22$job)]))
```

Die Plotdarstellung kann ähnlich manipuliert und angepasst werden:

```{r fig.keep=c(2), fig.align='left'}
#Erster QQ-Plot
qqnorm(scale(fb22$nerd[fb22$job==2]))
qqline(scale(fb22$nerd[fb22$job==2]))

#Zweiter QQ-Plot
qqnorm(scale(fb22$nerd[fb22$job==1]))
qqline(scale(fb22$nerd[fb22$job==1]))
```

Hier wurde im Codeblock `{r fig.keep=c(2), fig.align='left'}` festgelegt, deswegen wird nun im Text nur der erste QQ-Plot gezeigt und dieser linksbündig dargestellt, während der andere nicht dargestellt wird. Auch hier gibt es wieder eine Vielzahl an Optionen, mit denen man Plots verschieden individualisieren kann. PARAMETER VERLINKEN


## Der Sonderfall: Setup mit knitr

Der erste Code-Chunk in einem Dokument, der beim Erstellen eines neuen RMarkdown-Dokuments auch in RStudio miterstellt wird, ist typischerweise der Setup-Chunk. In ihm lassen sich durch Argumente verschiedene Regeln festlegen die im `default` auf jeden weiteren Code-Chunk zutreffen werden. Die [möglichen Befehle](https://www.rstudio.com/wp-content/uploads/2015/03/rmarkdown-reference.pdf?_ga=2.102259713.1013981012.1677056319-671987487.1666819594) innerhalb des Setup-Chunks sind weitreichend, meist wird dort aber nur definiert, ob man seinen Code und seine Ergebnisse standardmäßig anzeigen möchte und ob Warnungen oder Nachrichten angezeigt werden sollen. Letztere Optionen lauten bspw.

```
knitr::opts_chunk$set(include= TRUE, echo = TRUE, message = TRUE, warning = TRUE)
include ->
echo ->
message ->
warning ->
```

wenn man alle Elemente mit anzeigen möchte. Aber dies muss man auch nicht unbedingt selbst setzen, diese 4 Werte sind beispielsweise als `default = TRUE`, also standardmäßig auf `TRUE` gesetzt, und müssen daher eigentlich nur angepasst werden, wenn man sie spezifisch auf `FALSE` setzen will.


## Working Directory

Das Working Directory des RMD ist identisch zu dem, wie man es von R-Skripten gewohnt ist, es ist standardmäßig auf den Ordner gesetzt, in dem die RMD-Datei sich befindet. Mit einem Setup-Befehl lässt sich dieser auch anpassen, dieser sieht etwas komplexer aus, als man es von `setwd()` vielleicht gewohnt ist, erfüllt aber die selbe Funktion.

```
```{r, setup, include=FALSE}
knitr::opts_knit$set(root.dir = '/Ordner')
```
```


## Inline Code & Parameter

Genau so, wie man Abschnitte im Text visuell als Code herausstellen kann in RMarkdown, lässt sich auch R-Code im Text ausführen. In diesem Dokument wurden bspw. zu Beginn in einem nicht sichtbaren Codeblock zwei zufällige Zahlen zwischen 1 und 20 in einen Vektor gelegt.

Dieser Vektor lässt sich nun direkt darstellen mit ` r numberFunc ` , umschlossen von zwei Backticks ` `` `: `r numberFunc`.

Der Vektor der zwei Zahlen wird dabei direkt in einer Aufführung mit Kommas dargestellt. Die Zahlen werden immer neu randomisiert, wenn das Dokument bearbeitet und neu geladen wird.


## Fazit

RMarkdown kombiniert alle Facetten von Markdown, Pandoc und RMarkdown und kann so genutzt werden um R-Code und andere Inhalte dynamisch in einer Reihe verschiedener Formate auszugeben und darzustellen


***
