---
title: Gemischte Modelle für den Längsschnitt
date: '2023-02-28'
slug: lmm-long
categories: ["KiJu"]
tags: ["Regression", "Hierarchische Daten", "Zufallseffekte"]
subtitle: ''
summary: ''
authors: [schultze]
lastmod: '2023-02-28T14:20:00+01:00'
featured: no
header:
  image: "/header/KiJu_LMMsLang.jpg"
  caption: "[Courtesy of pexels](https://www.pexels.com/photo/asphalt-blur-car-city-290470/)"
projects: []
---



<p>Abschnitte:</p>
<ul>
<li><a href="#vorbereitung">Vorbereitung</a></li>
<li><a href="#state-trait-modell">LST-Grundmodell</a></li>
<li><a href="#einfache-wachstumskurven">Wachstumskurven</a></li>
<li><a href="#wachstumskurven-mit-prädiktoren">Vorhersagen von Veränderung</a></li>
<li><a href="#autoregressive-modelle">Autoregressive Modelle</a></li>
</ul>
<div id="vorbereitung" class="section level2">
<h2>Vorbereitung</h2>
<div id="kontinuierliche-vs.-diskrete-zeit" class="section level3">
<h3>Kontinuierliche vs. diskrete Zeit</h3>
<ul>
<li>Kontinuierliche Zeit
<ul>
<li>Zeit wird in “natürlichen” Einheiten (Millisekunden, Stunden, Tage, …) abgebildet</li>
<li>Veränderung ist eine (stetige) Funktion der Zeit</li>
<li>Eine funktionale Form wird vorgegeben (linear, quadratisch, logarithmisch)</li>
<li>Aus der Funktion wird auf alle zeitlichen Abstände generalisiert</li>
<li>Abstände zwischen Messungen können intra- und interindividuell variieren</li>
</ul></li>
<li>Diskrete Zeit
<ul>
<li>Zeit wird in künstlichen Einheiten (meist Messzeitpunkten) angegeben</li>
<li>Veränderung findet in Intervallen statt</li>
<li>Die Form der Veränderung ist unbekannt</li>
<li>Abstände zwischen Messungen müssen interindividuell identisch sein</li>
</ul></li>
</ul>
</div>
<div id="datenbeispiel" class="section level3">
<h3>Datenbeispiel</h3>
<pre class="r"><code>load(url(&#39;https://pandar.netlify.app/post/Sunday.rda&#39;))
head(sunday)</code></pre>
<pre><code>##   id mzp  pos  neg   gs  wm meq ctime gs_lag wm_lag
## 1  1   0 nein nein 2.00 1.0  33  2.23     NA     NA
## 2  1   1 nein nein 2.75 1.5  33  3.64   2.00    1.0
## 3  1   2   ja nein 2.00 2.5  33  5.21   2.75    1.5
## 4  1   3 nein nein 3.00 2.5  33  7.20   2.00    2.5
## 5  1   4 nein nein 3.00 2.0  33  9.57   3.00    2.5
## 6  1   5 nein nein 2.75 1.0  33 11.12   3.00    2.0</code></pre>
<p>Crayen, C., Eid, M., Lischetzke, T., Courvoisier, D. S. und Vermunt, J. K. (2012). Exploring dynamics in mood regulation—Mixture latent Markov modeling of ambulatory assessment data. <em>Psychosomatic Medicine</em>, 74, 366-376.</p>
<ul>
<li>Ambulatory-Assessment Studie zur Stimmungsregulation
<ul>
<li>Messzeitpunkte in 150 Personen (Variable id)</li>
<li>Bis zu 8 Messungen pro Tag, Zeitabstand zwischen 60 und 180 Minuten</li>
<li>Hier: Ein Tag (Sonntag) ausgewählt</li>
</ul></li>
<li>Berichten von Daily hassles (neg) oder Uplifts (pos)</li>
<li>Momentante gute Stimmung (gs) und Wachheit (wm), erfasst mit 4 bzw. 2 vierstufigen Items</li>
<li>Einmalige Einschätzung der eigenen Morningness (meq)</li>
<li>Zählung der individuellen Messzeitpunkte beginnt bei 0 (mzp)</li>
<li>Uhrzeit in (anteiligen) Stunden ab 8 Uhr morgens (ctime)</li>
<li>Vorherige gute Stimmung (gs_lag) und Wachheit (wm_lag), erfasst mit 4 bzw. 2 vierstufigen Items</li>
</ul>
</div>
<div id="pakete" class="section level3">
<h3>Pakete</h3>
<pre class="r"><code># Für Plots der Modelle - dauert einen Moment
install.packages(&#39;sjPlot&#39;, dependencies = TRUE)

# Für eine erweiterte Modellzusammenfassung
installpackages(&#39;jtools&#39;)</code></pre>
<p>Für alternative Ansätze der Darstellung bzw. Berechnung von Komponenten (nur in vereinzelten Beispielen genutzt)</p>
<pre class="r"><code># Für Inferenz der fixed effects
install.packages(&#39;lmerTest&#39;)

# Für Bestimmung von Pseudo R^2
install.packages(&#39;MuMIn&#39;)</code></pre>
<pre class="r"><code>library(lme4)</code></pre>
<pre><code>## Loading required package: Matrix</code></pre>
<pre class="r"><code>library(sjPlot)
library(jtools)
library(ggplot2)</code></pre>
</div>
</div>
<div id="state-trait-modell" class="section level2">
<h2>State-Trait-Modell</h2>
<p><strong>Level 1</strong>
<span class="math display">\[ y_{ti} = \beta_{0i} + r_{ti} \]</span></p>
<p><strong>Level 2</strong>
<span class="math display">\[ \beta_{0i} = \gamma_{00} + u_{0i} \]</span></p>
<p><strong>Gesamtgleichung</strong>
<span class="math display">\[ y_{ti} = \gamma_{00} + u_{0i} + r_{ti} \]</span>
- Klassisches Nullmodell, nur <span class="math inline">\(t\)</span> für “Time” und <span class="math inline">\(i\)</span> für “individual”
- Zerlegung in LST:
* <span class="math inline">\(\tau_{ti}\)</span>: True Score der Person <span class="math inline">\(i\)</span> zum Zeitpunkt <span class="math inline">\(t\)</span>
* <span class="math inline">\(\xi_{i}\)</span>: Trait der Person <span class="math inline">\(i\)</span>
* <span class="math inline">\(\zeta_{ti}\)</span>: State-Abweichung vom Trait zum Zeitpunkt <span class="math inline">\(t\)</span> für Person <span class="math inline">\(i\)</span></p>
<p><span class="math display">\[ \tau_{ti} = \xi_{i} + \zeta_{ti} \]</span></p>
<pre class="r"><code>mod0 &lt;- lmer(wm ~ 1 + (1 | id), sunday)
print(summ(mod0))</code></pre>
<pre><code>## MODEL INFO:
## Observations: 1069
## Dependent Variable: wm
## Type: Mixed effects linear regression 
## 
## MODEL FIT:
## AIC = 2417.01, BIC = 2431.93
## Pseudo-R² (fixed effects) = 0.00
## Pseudo-R² (total) = 0.22 
## 
## FIXED EFFECTS:
## --------------------------------------------------------
##                     Est.   S.E.   t val.     d.f.      p
## ----------------- ------ ------ -------- -------- ------
## (Intercept)         2.66   0.04    71.55   152.45   0.00
## --------------------------------------------------------
## 
## p values calculated using Satterthwaite d.f.
## 
## RANDOM EFFECTS:
## ------------------------------------
##   Group      Parameter    Std. Dev. 
## ---------- ------------- -----------
##     id      (Intercept)     0.37    
##  Residual                   0.69    
## ------------------------------------
## 
## Grouping variables:
## -------------------------
##  Group   # groups   ICC  
## ------- ---------- ------
##   id       148      0.22 
## -------------------------</code></pre>
<p>ICC: Stabilitätsausmaß (relativer Varianzanteil der Personeneigenschaften)</p>
<pre class="r"><code># Individuelle Traits (Ewartungswerte, beta0i)
coef(mod0)$id |&gt; head()</code></pre>
<pre><code>##   (Intercept)
## 1    2.025617
## 2    2.548404
## 3    2.461273
## 4    2.374142
## 5    3.027625
## 6    2.743919</code></pre>
<pre class="r"><code># Abweichungen (u0i)
ranef(mod0)$id |&gt; head()</code></pre>
<pre><code>##   (Intercept)
## 1 -0.63415702
## 2 -0.11137054
## 3 -0.19850162
## 4 -0.28563270
## 5  0.36785040
## 6  0.08414454</code></pre>
<pre class="r"><code>plot_model(mod0, &#39;re&#39;, sort.est = &#39;(Intercept)&#39;)</code></pre>
<p><img src="/post/2023-02-28-KiJu_LMMsLang_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
</div>
<div id="einfache-wachstumskurven" class="section level2">
<h2>Einfache Wachstumskurven</h2>
<div id="lineares-wachstum" class="section level3">
<h3>Lineares Wachstum</h3>
<ul>
<li>Random Intercept Modell mit Zeit als UV</li>
</ul>
<pre class="r"><code>mod1 &lt;- lmer(wm ~ 1 + ctime + (1 | id), sunday)
print(summ(mod1))</code></pre>
<pre><code>## MODEL INFO:
## Observations: 1069
## Dependent Variable: wm
## Type: Mixed effects linear regression 
## 
## MODEL FIT:
## AIC = 2418.90, BIC = 2438.80
## Pseudo-R² (fixed effects) = 0.01
## Pseudo-R² (total) = 0.23 
## 
## FIXED EFFECTS:
## --------------------------------------------------------
##                     Est.   S.E.   t val.     d.f.      p
## ----------------- ------ ------ -------- -------- ------
## (Intercept)         2.53   0.06    44.08   628.34   0.00
## ctime               0.02   0.01     2.96   952.29   0.00
## --------------------------------------------------------
## 
## p values calculated using Satterthwaite d.f.
## 
## RANDOM EFFECTS:
## ------------------------------------
##   Group      Parameter    Std. Dev. 
## ---------- ------------- -----------
##     id      (Intercept)     0.37    
##  Residual                   0.69    
## ------------------------------------
## 
## Grouping variables:
## -------------------------
##  Group   # groups   ICC  
## ------- ---------- ------
##   id       148      0.23 
## -------------------------</code></pre>
<pre class="r"><code>sunday$pred_mod1 &lt;- predict(mod1)

subset(sunday, as.numeric(id) &lt; 10) |&gt;
  ggplot(aes(x = ctime, y = wm, color = id)) + 
    geom_point() + 
    geom_line(aes(y = pred_mod1)) +
    theme_minimal() + facet_wrap(~ id)</code></pre>
<p><img src="/post/2023-02-28-KiJu_LMMsLang_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
</div>
<div id="kurvilineares-wachstum" class="section level3">
<h3>Kurvilineares Wachstum</h3>
<pre class="r"><code>plot_model(mod1, &#39;slope&#39;)</code></pre>
<pre><code>## `geom_smooth()` using formula = &#39;y ~ x&#39;
## `geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<p><img src="/post/2023-02-28-KiJu_LMMsLang_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<pre class="r"><code>sunday$ct_quad &lt;- sunday$ctime^2</code></pre>
<pre class="r"><code>mod2 &lt;- lmer(wm ~ 1 + poly(ctime, 2) + (1 | id), sunday)
print(summ(mod2))</code></pre>
<pre><code>## MODEL INFO:
## Observations: 1069
## Dependent Variable: wm
## Type: Mixed effects linear regression 
## 
## MODEL FIT:
## AIC = 2331.56, BIC = 2356.44
## Pseudo-R² (fixed effects) = 0.06
## Pseudo-R² (total) = 0.29 
## 
## FIXED EFFECTS:
## -------------------------------------------------------------
##                          Est.   S.E.   t val.     d.f.      p
## --------------------- ------- ------ -------- -------- ------
## (Intercept)              2.66   0.04    71.41   152.21   0.00
## poly(ctime, 2)1          2.08   0.67     3.11   949.36   0.00
## poly(ctime, 2)2         -6.02   0.67    -9.05   941.42   0.00
## -------------------------------------------------------------
## 
## p values calculated using Satterthwaite d.f.
## 
## RANDOM EFFECTS:
## ------------------------------------
##   Group      Parameter    Std. Dev. 
## ---------- ------------- -----------
##     id      (Intercept)     0.38    
##  Residual                   0.66    
## ------------------------------------
## 
## Grouping variables:
## -------------------------
##  Group   # groups   ICC  
## ------- ---------- ------
##   id       148      0.25 
## -------------------------</code></pre>
<ul>
<li>Was ist eigentlich <code>poly</code>? –&gt; <a href="/post/quadratische-und-moderierte-regression/#AppendixA">siehe Dokumentation hier</a>
<ul>
<li>Gesamtmodell nicht anders gegenüber händischem Quadrat</li>
<li>Nötig, sobald mehr als quadratische Terme, immer sinnvoll</li>
<li>Anschließende Darstellung etwas komplizierter</li>
</ul></li>
</ul>
<pre class="r"><code>plot_model(mod2, &#39;pred&#39;) # hässlich

# schöner
sunday$pred_mod2 &lt;- predict(mod2)
ggplot(sunday, aes(x = ctime, y = pred_mod2)) + 
  geom_smooth(se = FALSE)</code></pre>
</div>
<div id="random-slopes-modell" class="section level3">
<h3>Random Slopes Modell</h3>
<pre class="r"><code>tmp &lt;- poly(sunday$ctime, 2)
tmp &lt;- as.data.frame(tmp)
names(tmp) &lt;- c(&#39;poly1&#39;, &#39;poly2&#39;)
sunday &lt;- cbind(sunday, tmp)
mod3a &lt;- lmer(wm ~ 1 + poly1 + poly2 + (1 + poly1 | id), sunday)
mod3b &lt;- lmer(wm ~ 1 + poly1 + poly2 + (1 + poly1 + poly2 | id), sunday)
anova(mod2, mod3a, mod3b, refit = FALSE)</code></pre>
<pre><code>## Data: sunday
## Models:
## mod2: wm ~ 1 + poly(ctime, 2) + (1 | id)
## mod3a: wm ~ 1 + poly1 + poly2 + (1 + poly1 | id)
## mod3b: wm ~ 1 + poly1 + poly2 + (1 + poly1 + poly2 | id)
##       npar    AIC    BIC  logLik deviance  Chisq Df Pr(&gt;Chisq)    
## mod2     5 2331.6 2356.4 -1160.8   2321.6                         
## mod3a    7 2242.3 2277.1 -1114.1   2228.3 93.299  2  &lt; 2.2e-16 ***
## mod3b   10 2226.5 2276.3 -1103.3   2206.5 21.752  3  7.346e-05 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>print(summ(mod3b))</code></pre>
<pre><code>## MODEL INFO:
## Observations: 1069
## Dependent Variable: wm
## Type: Mixed effects linear regression 
## 
## MODEL FIT:
## AIC = 2226.51, BIC = 2276.26
## Pseudo-R² (fixed effects) = 0.07
## Pseudo-R² (total) = 0.51 
## 
## FIXED EFFECTS:
## ---------------------------------------------------------
##                      Est.   S.E.   t val.     d.f.      p
## ----------------- ------- ------ -------- -------- ------
## (Intercept)          2.66   0.04    71.32   151.82   0.00
## poly1                2.38   1.00     2.37   151.94   0.02
## poly2               -6.32   0.73    -8.62   137.32   0.00
## ---------------------------------------------------------
## 
## p values calculated using Satterthwaite d.f.
## 
## RANDOM EFFECTS:
## ------------------------------------
##   Group      Parameter    Std. Dev. 
## ---------- ------------- -----------
##     id      (Intercept)     0.40    
##     id         poly1        9.81    
##     id         poly2        5.18    
##  Residual                   0.55    
## ------------------------------------
## 
## Grouping variables:
## -------------------------
##  Group   # groups   ICC  
## ------- ---------- ------
##   id       148      0.34 
## -------------------------</code></pre>
<pre class="r"><code>VarCorr(mod3b)</code></pre>
<pre><code>##  Groups   Name        Std.Dev. Corr         
##  id       (Intercept) 0.39924               
##           poly1       9.80970  -0.131       
##           poly2       5.18308  -0.003 -0.498
##  Residual             0.55216</code></pre>
<pre class="r"><code>sunday$pred_mod3 &lt;- predict(mod3b)

subset(sunday, as.numeric(id) &lt; 10) |&gt;
  ggplot(aes(x = ctime, y = wm, color = id)) + 
    geom_point() + 
    geom_line(aes(y = pred_mod3)) +
    theme_minimal() + facet_wrap(~ id)</code></pre>
<p><img src="/post/2023-02-28-KiJu_LMMsLang_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
</div>
</div>
<div id="wachstumskurven-mit-prädiktoren" class="section level2">
<h2>Wachstumskurven mit Prädiktoren</h2>
<ul>
<li>Dynamische Prädiktoren (L1-Prädiktoren)
<ul>
<li>Variablen auf Ebene der Zeitpunkte</li>
<li>Situationale Faktoren (z. B. Zeit, Ort, soziale Umgebung)</li>
<li>Variable Personenfaktoren (z. B. Stimmung, wahrgenommener Stress)</li>
<li>Erklären Abweichungen der Situationen vom generellen Trend</li>
</ul></li>
<li>Stabile Prädiktoren (L2-Prädiktoren)
<ul>
<li>Variablen auf Ebene der Personen</li>
<li>Generell stabile Merkmale (z. B. Geschlecht, Big 5, SES)</li>
<li>Innerhalb der Erhebung unveränderliche Merkmale (z.B. Experimentalgruppe, Baselinemerkmale)</li>
<li>Erklären interindividuelle Unterschiede (in der Veränderung)</li>
</ul></li>
</ul>
<div id="dynamische-prädiktoren" class="section level3">
<h3>Dynamische Prädiktoren</h3>
<pre class="r"><code>mod4 &lt;- lmer(wm ~ 1 + poly1 + poly2 + pos + (1 + poly1 + poly2 | id), sunday)
print(summ(mod4))</code></pre>
<pre><code>## MODEL INFO:
## Observations: 1069
## Dependent Variable: wm
## Type: Mixed effects linear regression 
## 
## MODEL FIT:
## AIC = 2223.53, BIC = 2278.25
## Pseudo-R² (fixed effects) = 0.08
## Pseudo-R² (total) = 0.51 
## 
## FIXED EFFECTS:
## ---------------------------------------------------------
##                      Est.   S.E.   t val.     d.f.      p
## ----------------- ------- ------ -------- -------- ------
## (Intercept)          2.62   0.04    67.34   184.36   0.00
## poly1                2.37   1.00     2.37   151.40   0.02
## poly2               -6.31   0.74    -8.58   136.08   0.00
## posja                0.14   0.05     3.06   950.09   0.00
## ---------------------------------------------------------
## 
## p values calculated using Satterthwaite d.f.
## 
## RANDOM EFFECTS:
## ------------------------------------
##   Group      Parameter    Std. Dev. 
## ---------- ------------- -----------
##     id      (Intercept)     0.39    
##     id         poly1        9.79    
##     id         poly2        5.27    
##  Residual                   0.55    
## ------------------------------------
## 
## Grouping variables:
## -------------------------
##  Group   # groups   ICC  
## ------- ---------- ------
##   id       148      0.34 
## -------------------------</code></pre>
<pre class="r"><code>sunday$pred_mod4 &lt;- predict(mod4)

subset(sunday, as.numeric(id) &lt; 10) |&gt;
  ggplot(aes(x = ctime, y = wm, color = id)) + 
    geom_point(aes(shape = pos)) + 
    geom_line(aes(y = pred_mod4)) +
    theme_minimal() + facet_wrap(~ id)</code></pre>
<p><img src="/post/2023-02-28-KiJu_LMMsLang_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<p>Sonderfall <em>discontinuous growth</em>:
- L1-Prädiktoren können auch Kodiervariablen sein
* Übergang zwischen Grund- und Sekundarschule
* Interventionsbeginn
* Tagesübergänge
- Kodiervariablen können plötzliche Sprünge oder eine Veränderung des Wachstums ermöglichen</p>
<table>
<thead>
<tr class="header">
<th>time</th>
<th>event</th>
<th>ptime</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td>2</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td>3</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td>4</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="odd">
<td>5</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td>6</td>
<td>1</td>
<td>2</td>
</tr>
<tr class="odd">
<td>7</td>
<td>1</td>
<td>3</td>
</tr>
</tbody>
</table>
<ul>
<li>“event”: plötzlicher Sprung im Niveau</li>
<li>“ptime”: Veränderung der Trajectory</li>
</ul>
</div>
<div id="stabile-prädiktoren" class="section level3">
<h3>Stabile Prädiktoren</h3>
<pre class="r"><code>mod5 &lt;- lmer(wm ~ 1 + poly1 + poly2 + meq + (1 + poly1 + poly2 | id), sunday)
print(summ(mod5))</code></pre>
<pre><code>## MODEL INFO:
## Observations: 1069
## Dependent Variable: wm
## Type: Mixed effects linear regression 
## 
## MODEL FIT:
## AIC = 2236.90, BIC = 2291.62
## Pseudo-R² (fixed effects) = 0.07
## Pseudo-R² (total) = 0.51 
## 
## FIXED EFFECTS:
## ---------------------------------------------------------
##                      Est.   S.E.   t val.     d.f.      p
## ----------------- ------- ------ -------- -------- ------
## (Intercept)          2.69   0.16    16.63   153.33   0.00
## poly1                2.37   1.00     2.36   151.91   0.02
## poly2               -6.32   0.73    -8.62   137.25   0.00
## meq                 -0.00   0.01    -0.21   153.07   0.83
## ---------------------------------------------------------
## 
## p values calculated using Satterthwaite d.f.
## 
## RANDOM EFFECTS:
## ------------------------------------
##   Group      Parameter    Std. Dev. 
## ---------- ------------- -----------
##     id      (Intercept)     0.40    
##     id         poly1        9.81    
##     id         poly2        5.19    
##  Residual                   0.55    
## ------------------------------------
## 
## Grouping variables:
## -------------------------
##  Group   # groups   ICC  
## ------- ---------- ------
##   id       148      0.35 
## -------------------------</code></pre>
</div>
<div id="cross-level-interaktionen" class="section level3">
<h3>Cross-Level-Interaktionen</h3>
<pre class="r"><code>mod6 &lt;- lmer(wm ~ 1 + poly1*meq + poly2*meq + (1 + poly1 + poly2 | id), sunday)
print(summ(mod6))</code></pre>
<pre><code>## MODEL INFO:
## Observations: 1069
## Dependent Variable: wm
## Type: Mixed effects linear regression 
## 
## MODEL FIT:
## AIC = 2232.68, BIC = 2297.35
## Pseudo-R² (fixed effects) = 0.08
## Pseudo-R² (total) = 0.51 
## 
## FIXED EFFECTS:
## ---------------------------------------------------------
##                      Est.   S.E.   t val.     d.f.      p
## ----------------- ------- ------ -------- -------- ------
## (Intercept)          2.63   0.16    16.17   153.83   0.00
## poly1               17.34   4.23     4.09   156.44   0.00
## meq                  0.00   0.01     0.20   153.70   0.85
## poly2               -9.38   3.20    -2.93   139.60   0.00
## poly1:meq           -0.56   0.15    -3.63   156.40   0.00
## meq:poly2            0.11   0.12     0.95   140.16   0.34
## ---------------------------------------------------------
## 
## p values calculated using Satterthwaite d.f.
## 
## RANDOM EFFECTS:
## ------------------------------------
##   Group      Parameter    Std. Dev. 
## ---------- ------------- -----------
##     id      (Intercept)     0.40    
##     id         poly1        9.21    
##     id         poly2        5.23    
##  Residual                   0.55    
## ------------------------------------
## 
## Grouping variables:
## -------------------------
##  Group   # groups   ICC  
## ------- ---------- ------
##   id       148      0.34 
## -------------------------</code></pre>
<pre class="r"><code>plot_model(mod6, &#39;pred&#39;, terms = c(&#39;poly1&#39;, &#39;meq&#39;))</code></pre>
<p><img src="/post/2023-02-28-KiJu_LMMsLang_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
</div>
</div>
<div id="autoregressive-modelle" class="section level2">
<h2>Autoregressive Modelle</h2>
<ul>
<li>Beliebt weil Grundlage für Vektor-Autoregressive Modelle (Längsschnitt-Netzwerkanalysen)</li>
<li>iid Annahme (independent and identically distributed)
<ul>
<li>L1-Residuen sind voneinander unabhängig</li>
<li>L1-Residuen folgen der gleichen Verteilung (impliziert Homoskedastizität)</li>
</ul></li>
<li>Annahmen der OLS Regression
<ul>
<li>Unabhängigkeit der Residuen</li>
<li>Homoskedastizität der Residuen</li>
</ul></li>
<li>MLM berücksichtigt nur Abhängigkeiten durch angegebene Cluster-Variablen</li>
<li>Andere Abhängigkeiten (serielle Abhängigkeit, weitere Clusterungsebenen, usw.) können weiterhin zu Verzerrungen führen</li>
</ul>
<div id="explizite-autoregression" class="section level3">
<h3>Explizite Autoregression</h3>
<ul>
<li>Lag Variable erstellen</li>
</ul>
<pre class="r"><code># mit basis R-Befehlen
sunday$wm_lag &lt;- NA
for (i in sunday$id) {
  sunday[sunday$id == i, &#39;wm_lag&#39;] &lt;- embed(c(NA, sunday[sunday$id == i, &#39;wm&#39;]), 2)[, 2]
}

# mit dplyr (sehr verbreitet)
library(dplyr)
sunday &lt;- group_by(sunday, id) %&gt;% mutate(wm_lag = lag(wm))</code></pre>
<pre class="r"><code>mod0 &lt;- lmer(gs ~ 1 + (1 | id), sunday)
mod1 &lt;- lmer(gs ~ 1 + gs_lag + (1 | id), sunday)
anova(mod0, mod1)</code></pre>
<pre><code>## Error in anova.merMod(mod0, mod1): models were not all fitted to the same size of dataset</code></pre>
<pre class="r"><code>mod0b &lt;- update(mod0, data = mod1@frame)
mod1b &lt;- update(mod1, data = mod1@frame)
anova(mod0b, mod1b)</code></pre>
<pre><code>## refitting model(s) with ML (instead of REML)</code></pre>
<pre><code>## Data: mod1@frame
## Models:
## mod0b: gs ~ 1 + (1 | id)
## mod1b: gs ~ 1 + gs_lag + (1 | id)
##       npar    AIC    BIC  logLik deviance  Chisq Df Pr(&gt;Chisq)    
## mod0b    3 1189.9 1204.4 -591.95   1183.9                         
## mod1b    4 1078.8 1098.1 -535.38   1070.8 113.13  1  &lt; 2.2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Drei Varianzkomponenten:</p>
<ul>
<li>Stabiler Anteil (ICC)</li>
<li>Vorhersagbare State-Komponente</li>
<li>Unvorhersagbare State-Komponente</li>
</ul>
<pre class="r"><code>MuMIn::r.squaredGLMM(mod0b)</code></pre>
<pre><code>## Warning: &#39;r.squaredGLMM&#39; now calculates a revised statistic. See the help page.</code></pre>
<pre><code>##      R2m       R2c
## [1,]   0 0.4405919</code></pre>
<pre class="r"><code>MuMIn::r.squaredGLMM(mod1b)</code></pre>
<pre><code>##            R2m       R2c
## [1,] 0.2419568 0.3217569</code></pre>
<pre class="r"><code>print(summ(mod1b))</code></pre>
<pre><code>## MODEL INFO:
## Observations: 921
## Dependent Variable: gs
## Type: Mixed effects linear regression 
## 
## MODEL FIT:
## AIC = 1090.18, BIC = 1109.49
## Pseudo-R² (fixed effects) = 0.24
## Pseudo-R² (total) = 0.32 
## 
## FIXED EFFECTS:
## --------------------------------------------------------
##                     Est.   S.E.   t val.     d.f.      p
## ----------------- ------ ------ -------- -------- ------
## (Intercept)         1.59   0.09    17.60   367.60   0.00
## gs_lag              0.47   0.03    16.02   407.11   0.00
## --------------------------------------------------------
## 
## p values calculated using Satterthwaite d.f.
## 
## RANDOM EFFECTS:
## ------------------------------------
##   Group      Parameter    Std. Dev. 
## ---------- ------------- -----------
##     id      (Intercept)     0.14    
##  Residual                   0.41    
## ------------------------------------
## 
## Grouping variables:
## -------------------------
##  Group   # groups   ICC  
## ------- ---------- ------
##   id       148      0.11 
## -------------------------</code></pre>
<p>Serielle Abhängigkeit:
<span class="math display">\[
  y_{ti} = \gamma_{00} + \gamma_{10} y_{(t-1)i} + u_{0i} + r_{ti} \\
  y_{(t-1)i} = \gamma_{00} + \gamma_{10} y_{(t-2)i} + u_{0i} + r_{(t-1)i} \\
\]</span></p>
<p>Indirekter Effekt: <span class="math inline">\(\beta_{t(t-\text{lag})} = \gamma_{10}^{\text{lag}}\)</span></p>
<pre class="r"><code>curve(.47^x, xlim = c(0, 7))</code></pre>
<p><img src="/post/2023-02-28-KiJu_LMMsLang_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<ul>
<li>Vorteile expliziter AR:
<ul>
<li>Einfache Spezifikation und Interpretation</li>
<li>Umgeht die Unabhängigkeitsannahme</li>
<li>Erlaubt Zufallseffekte der Autoregression</li>
</ul></li>
<li>Nachteile expliziter AR:
<ul>
<li>Nimmt zusätzliche Prädiktoren in die Gleichung auf</li>
<li>Erste Messung pro Person entfällt durch Missing</li>
<li>Nimmt gleiche Abstände zwischen Messungen an</li>
<li>Interpretation der Parameter immer unter Annahme gleicher Werte zum vorherigen Zeitpunkt</li>
</ul></li>
</ul>
</div>
<div id="autoregressive-fehlerstruktur" class="section level3">
<h3>Autoregressive Fehlerstruktur</h3>
<ul>
<li>Ohne zusätzlichen Prädiktoren</li>
<li>Residualkovarianzmatrix wird verändert</li>
<li>Gleiche Idee: ein Parameter (<span class="math inline">\(\rho\)</span>) bezeichnet die zusätzliche Abhängigkeit zwischen benachbarten Messungen</li>
<li>Voraussetzung ist hier, dass der autoregressive Effekte positiv ist</li>
</ul>
<p><span class="math display">\[
  \Sigma_{r} = var(r_{ti})
    \begin{bmatrix}
      1 &amp; \rho &amp; \rho^2 &amp; \rho^3 \\
      \rho &amp; 1 &amp; \rho &amp; \rho^2 \\
      \rho^2 &amp; \rho &amp; 1 &amp; \rho \\
      \rho^3 &amp; \rho^2 &amp; \rho &amp; 1
    \end{bmatrix}
\]</span></p>
<ul>
<li>lme4 dazu nicht in der Lage
<ul>
<li>viele alternative Pakete können verschiedene Residualstrukturen</li>
<li>hier Awendung mit <code>nlme</code>, weil vorinstalliert und <code>lme4</code> relativ ähnlich</li>
</ul></li>
</ul>
<pre class="r"><code>library(nlme)</code></pre>
<pre><code>## 
## Attaching package: &#39;nlme&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:lme4&#39;:
## 
##     lmList</code></pre>
<pre class="r"><code>mod0_nlme &lt;- lme(fixed = gs ~ 1, random = ~ 1 | id, data = sunday)
summary(mod0_nlme)</code></pre>
<pre><code>## Linear mixed-effects model fit by REML
##   Data: sunday 
##        AIC      BIC    logLik
##   1386.189 1401.109 -690.0943
## 
## Random effects:
##  Formula: ~1 | id
##         (Intercept)  Residual
## StdDev:   0.3489966 0.4055539
## 
## Fixed effects:  gs ~ 1 
##                Value  Std.Error  DF  t-value p-value
## (Intercept) 3.001416 0.03132548 921 95.81391       0
## 
## Standardized Within-Group Residuals:
##           Min            Q1           Med            Q3           Max 
## -5.5913005031 -0.4191647703 -0.0005044242  0.4940976394  2.5971130291 
## 
## Number of Observations: 1069
## Number of Groups: 148</code></pre>
<pre class="r"><code>summary(mod0)</code></pre>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: gs ~ 1 + (1 | id)
##    Data: sunday
## 
## REML criterion at convergence: 1380.2
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -5.5913 -0.4192 -0.0005  0.4941  2.5971 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  id       (Intercept) 0.1218   0.3490  
##  Residual             0.1645   0.4056  
## Number of obs: 1069, groups:  id, 148
## 
## Fixed effects:
##             Estimate Std. Error t value
## (Intercept)  3.00142    0.03133   95.81</code></pre>
<pre class="r"><code>mod1_nlme &lt;- lme(fixed = gs ~ 1, random = ~ 1 | id, data = sunday, 
  correlation = corAR1())
summary(mod1_nlme)</code></pre>
<pre><code>## Linear mixed-effects model fit by REML
##   Data: sunday 
##        AIC     BIC    logLik
##   1296.226 1316.12 -644.1131
## 
## Random effects:
##  Formula: ~1 | id
##         (Intercept) Residual
## StdDev:   0.3021535 0.442272
## 
## Correlation Structure: AR(1)
##  Formula: ~1 | id 
##  Parameter estimate(s):
##       Phi 
## 0.3919874 
## Fixed effects:  gs ~ 1 
##                Value  Std.Error  DF  t-value p-value
## (Intercept) 2.996439 0.03125952 921 95.85685       0
## 
## Standardized Within-Group Residuals:
##         Min          Q1         Med          Q3         Max 
## -5.09726494 -0.35562195  0.00323874  0.47579376  2.39482725 
## 
## Number of Observations: 1069
## Number of Groups: 148</code></pre>
<ul>
<li>Das correlation-Argument erlaubt die Spezifikation einer Korrelationsstruktur auf L1</li>
<li><code>corAR1()</code> wählt die autoregressive Struktur 1. Ordnung</li>
<li>Es wird angenommen, dass die Daten richtig sortiert sind!</li>
</ul>
</div>
<div id="zeitkontinuierliche-autoregression" class="section level3">
<h3>Zeitkontinuierliche Autoregression</h3>
<ul>
<li>Bisherige Annahme: gleiche Abstände der Messungen, gleiche Messungen für alle Personen
<ul>
<li><span class="math inline">\(\phi\)</span> bzw. <span class="math inline">\(\gamma_{10}\)</span> beschreiben AR zwischen <span class="math inline">\(t\)</span> und <span class="math inline">\(t-1\)</span> (diskrete Zeitpunkte)</li>
<li><span class="math inline">\(\phi\)</span> berücksichtigt dabei nicht zeitlichen Abstand zwischen <span class="math inline">\(t\)</span> und <span class="math inline">\(t-1\)</span></li>
</ul></li>
</ul>
<pre class="r"><code>mod2_nlme &lt;- lme(fixed = gs ~ 1, random = ~ 1 | id, data = sunday, 
  correlation = corCAR1(, form = ~ ctime))
summary(mod2_nlme)</code></pre>
<pre><code>## Linear mixed-effects model fit by REML
##   Data: sunday 
##        AIC     BIC    logLik
##   1289.736 1309.63 -640.8678
## 
## Random effects:
##  Formula: ~1 | id
##         (Intercept)  Residual
## StdDev:   0.3072518 0.4405892
## 
## Correlation Structure: Continuous AR(1)
##  Formula: ~ctime | id 
##  Parameter estimate(s):
##       Phi 
## 0.5690876 
## Fixed effects:  gs ~ 1 
##                Value  Std.Error  DF  t-value p-value
## (Intercept) 2.997053 0.03133165 921 95.65577       0
## 
## Standardized Within-Group Residuals:
##          Min           Q1          Med           Q3          Max 
## -5.138995611 -0.379382642  0.002754803  0.480001652  2.405839942 
## 
## Number of Observations: 1069
## Number of Groups: 148</code></pre>
<ul>
<li><span class="math inline">\(\phi\)</span> hier interpretieren als AR über eine Stunde
<ul>
<li>In diskretem Fall: AR zwischen zwei Zeitpunkten</li>
<li>Mittlerer Abstand zwischen zwei Zeitpunkten: 1.79</li>
<li>Annäherung: <span class="math inline">\(.569^{1.79} = 0.365\)</span> (aus Ergebnis oben: <span class="math inline">\(\phi = .392\)</span>)</li>
</ul></li>
</ul>
</div>
</div>
