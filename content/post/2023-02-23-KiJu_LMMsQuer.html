---
title: Einführung in gemischte Modelle mit lme4
date: '2023-02-23'
slug: lmm-intro
categories: ["KiJu"]
tags: ["Regression", "Hierarchische Daten", "Zufallseffekte"]
subtitle: ''
summary: ''
authors: [schultze]
lastmod: '2023-02-23T16:20:00+01:00'
featured: no
header:
  image: "/header/KiJu_LMMsQuer.jpg"
  caption: "[Courtesy of pexels](https://www.pexels.com/photo/bunches-of-grapes-hanging-from-vines-3840335/)"
projects: []
---



<div id="vorbereitung" class="section level2">
<h2>Vorbereitung</h2>
<div id="datenbeispiel" class="section level3">
<h3>Datenbeispiel</h3>
<ul>
<li>International College Survey (Diener, Kim-Pietro, Scollon, et al., 2001)</li>
<li>Wohlbefinden in unterschiedlichen Ländern</li>
</ul>
<pre class="r"><code>load(url(&#39;https://pandar.netlify.app/post/kultur.rda&#39;))
head(kultur)[, 1:8]</code></pre>
<pre><code>##   nation female auf_e kla_e lezu       pa    na         bal
## 1 Turkey   male   3.0   3.0  4.0 4.333333 4.250  0.08333333
## 2 Turkey female   2.5   2.5  5.6 5.333333 7.375 -2.04166667
## 3 Turkey female   3.0   3.0  4.0 5.666667 2.000  3.66666667
## 4 Turkey female   3.5   3.0  2.4 3.833333 5.000 -1.16666667
## 5 Turkey female   3.5   2.5  2.0 5.666667 6.125 -0.45833333
## 6 Turkey   male   3.0   3.0  4.4 6.666667 4.500  2.16666667</code></pre>
<ul>
<li>Lebenszufriedenheit (lezu)
<ul>
<li>5 Items auf einer Skala von 1 (“strongly disagree”) bis 7 (“strongly agree”)</li>
<li>z.B. “I am satisfied with my life”</li>
</ul></li>
<li>Positiver Affekt (pa) &amp; negativer Affekt (na)
<ul>
<li>“For the following list of emotions, please rate how often you felt each of the emotions in the last week”</li>
<li>Skala von 1 (“not at all”) bis 7 (“all the time”)</li>
<li>Für positiven Affekt: Pleasant, Happy, Cheerful, etc.</li>
<li>Für negativen Affekt: Unpleasant, Sad, Anger, etc.</li>
</ul></li>
<li>Klarheit eigener Gefühle (kla_e)</li>
<li>Aufmerksamkeit auf eigene Gefühle (auf_e)</li>
<li>Schachtelung in Nationen (nation)</li>
</ul>
</div>
<div id="regressionsergebnisse-im-beispiel" class="section level3">
<h3>Regressionsergebnisse im Beispiel</h3>
<pre class="r"><code>mod &lt;- lm(lezu ~ 1 + pa, kultur)
summary(mod)</code></pre>
<pre><code>## 
## Call:
## lm(formula = lezu ~ 1 + pa, data = kultur)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -4.4262 -0.7588  0.1076  0.7743  3.0413 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 2.225025   0.049592   44.87   &lt;2e-16 ***
## pa          0.400132   0.008679   46.10   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1.086 on 7139 degrees of freedom
##   (53 observations deleted due to missingness)
## Multiple R-squared:  0.2294, Adjusted R-squared:  0.2293 
## F-statistic:  2126 on 1 and 7139 DF,  p-value: &lt; 2.2e-16</code></pre>
<ul>
<li>Darstellung der Ergebnisse (siehe <a href="https://pandar.netlify.app/extras/#ggplotting">ggplotting unter Extras</a>)</li>
</ul>
<pre class="r"><code>library(ggplot2)
ggplot(kultur, aes(x = pa, y = lezu)) + 
  geom_point() +
  geom_abline(intercept = coef(mod)[1], slope = coef(mod)[2], color = &#39;blue&#39;) +
  theme_minimal()</code></pre>
<pre><code>## Warning: Removed 53 rows containing missing values (`geom_point()`).</code></pre>
<p><img src="/post/2023-02-23-KiJu_LMMsQuer_files/figure-html/scatter-reg-1.png" width="672" /></p>
<ul>
<li>R-Funktionen für Regression</li>
</ul>
<table>
<thead>
<tr class="header">
<th>Befehl</th>
<th>Funktionalität</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>summary()</code></td>
<td>Zusammenfassung der Ergebnisse</td>
</tr>
<tr class="even">
<td><code>coef()</code></td>
<td>Koeffizienten ausgeben lassen</td>
</tr>
<tr class="odd">
<td><code>confint()</code></td>
<td>Konfidenzintervalle für Koeffizienten</td>
</tr>
<tr class="even">
<td><code>resid()</code></td>
<td>Ausgabe der <span class="math inline">\(e_{i}\)</span></td>
</tr>
<tr class="odd">
<td><code>predict()</code></td>
<td>Ausgabe der <span class="math inline">\(\hat{y}_i\)</span></td>
</tr>
<tr class="even">
<td><code>anova()</code></td>
<td>Modellvergleiche</td>
</tr>
<tr class="odd">
<td><code>plot()</code></td>
<td>Residuenplots zur Diagnostik</td>
</tr>
</tbody>
</table>
</div>
<div id="pakete" class="section level3">
<h3>Pakete</h3>
<pre class="r"><code># Für Plots der Modelle - dauert einen Moment
install.packages(&#39;sjPlot&#39;, dependencies = TRUE)

# Für eine erweiterte Modellzusammenfassung
installpackages(&#39;jtools&#39;)</code></pre>
<p>Für alternative Ansätze der Darstellung bzw. Berechnung von Komponenten (nur in vereinzelten Beispielen genutzt)</p>
<pre class="r"><code># Für Inferenz der fixed effects
install.packages(&#39;lmerTest&#39;)

# Für Bestimmung von Pseudo R^2
install.packages(&#39;MuMIn&#39;)</code></pre>
</div>
</div>
<div id="hintergrund-zu-lmms" class="section level2">
<h2>Hintergrund zu LMMs</h2>
<ul>
<li><p>Verletzung der Annahme unabhängiger Beobachtungen</p>
<ul>
<li>Varianz kleiner als bei Zufallsstichprobe (wegen Abhängigkeiten)</li>
<li>Effektives <span class="math inline">\(n\)</span> überschätzt</li>
<li>Präzision der Effekte überschätzt (SE unterschätzt)</li>
</ul></li>
<li><p>Koeffizienten nicht verzerrt, aber gemischt</p>
<ul>
<li>Risiko falscher Schlüsse</li>
</ul></li>
<li><p>Für Umgang mit Voraussetzungsverletzung ist Korrektur der SE ausreichend</p></li>
<li><p>Für korrekte Zerlegung von Effekten und deren Wirkebene: LMMs</p></li>
<li><p>Feste Effekte (Kodiervariablen)</p>
<ul>
<li>Aussagen über einzelne Ausprägungen relevant</li>
<li>Durch Studiendesign festgelegt oder natürliche Gruppen</li>
<li>Geschlecht, Therapieansätze, Schulformen</li>
</ul></li>
<li><p>Zufällige Effekte (LMMs)</p>
<ul>
<li>Zusammenfassende Aussagen über viele Ausprägungen relevant</li>
<li>Per Zufall aus Population gezogen</li>
<li>Schulklasse, Therapeut:innen, Teams</li>
</ul></li>
<li><p>Übliche Begriffe</p>
<ul>
<li>Mehrebenenmodelle</li>
<li>Gemischte Modelle (LMMs)</li>
<li>Hierarchische Modelle</li>
</ul></li>
</ul>
<table>
<thead>
<tr class="header">
<th>Level 2</th>
<th>Level 1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>macro-units</td>
<td>micro-units</td>
</tr>
<tr class="even">
<td>primary units</td>
<td>secondary units</td>
</tr>
<tr class="odd">
<td>clusters</td>
<td>elementary units</td>
</tr>
<tr class="even">
<td>between level</td>
<td>within level</td>
</tr>
</tbody>
</table>
</div>
<div id="nullmodell" class="section level2">
<h2>Nullmodell</h2>
<div id="notation" class="section level3">
<h3>Notation</h3>
<table>
<thead>
<tr class="header">
<th>Notation</th>
<th>Bedeutung</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(y_{ij}\)</span></td>
<td>AV-Wert von Person <span class="math inline">\(i\)</span> in Cluster <span class="math inline">\(j\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\(r_{ij}\)</span></td>
<td>Residuum auf L1, Abweichung der Person von Vorhersage</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(u_{0j}\)</span></td>
<td>Residuum auf L2, Abweichung des Clusters von Vorhersage</td>
</tr>
<tr class="even">
<td><span class="math inline">\(\beta_{0j}\)</span></td>
<td>(bedingter) Erwartungswert für Cluster <span class="math inline">\(j\)</span></td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\gamma_{00}\)</span></td>
<td>Erwartungswert der Erwartungswerte über alle Cluster</td>
</tr>
</tbody>
</table>
<p><strong>Level 1</strong>
<span class="math display">\[ y_{ij} = \beta_{0j} + r_{ij} \]</span></p>
<p><strong>Level 2</strong>
<span class="math display">\[ \beta_{0j} = \gamma_{00} + u_{0j} \]</span></p>
<p><strong>Gesamtgleichung</strong>
<span class="math display">\[ y_{ij} = \gamma_{00} + u_{0j} + r_{ij} \]</span></p>
</div>
<div id="nullmodell-in-lme4" class="section level3">
<h3>Nullmodell in lme4</h3>
<pre class="r"><code>library(lme4)</code></pre>
<pre><code>## Loading required package: Matrix</code></pre>
<pre class="r"><code>mod0 &lt;- lmer(lezu ~ 1 + (1 | nation), kultur)</code></pre>
<p>Generelle Schreibweise:</p>
<ul>
<li><code>lmer</code>: <em>linear mixed effects regression</em></li>
<li><code>AV ~ UV</code>: wie in <code>lm</code></li>
<li><code>(RE | Cluster)</code>: Welcher Parameter (<code>RE</code>) soll über die Cluster variieren dürfen</li>
</ul>
<pre class="r"><code>summary(mod0)</code></pre>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: lezu ~ 1 + (1 | nation)
##    Data: kultur
## 
## REML criterion at convergence: 21954.9
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -3.8470 -0.6650  0.0939  0.7345  3.3902 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  nation   (Intercept) 0.2854   0.5342  
##  Residual             1.2296   1.1089  
## Number of obs: 7163, groups:  nation, 40
## 
## Fixed effects:
##             Estimate Std. Error t value
## (Intercept)  4.39599    0.08581   51.23</code></pre>
</div>
<div id="inferenzstatistik-in-lme4" class="section level3">
<h3>Inferenzstatistik in lme4</h3>
<pre class="r"><code>confint(mod0)</code></pre>
<pre><code>## Computing profile confidence intervals ...</code></pre>
<pre><code>##                 2.5 %    97.5 %
## .sig01      0.4264675 0.6719161
## .sigma      1.0908914 1.1273144
## (Intercept) 4.2259305 4.5662197</code></pre>
<pre class="r"><code>library(lmerTest)</code></pre>
<pre><code>## 
## Attaching package: &#39;lmerTest&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:lme4&#39;:
## 
##     lmer</code></pre>
<pre><code>## The following object is masked from &#39;package:stats&#39;:
## 
##     step</code></pre>
<pre class="r"><code>mod0 &lt;- lmer(lezu ~ 1 + (1 | nation), kultur)
summary(mod0)</code></pre>
<pre><code>## Linear mixed model fit by REML. t-tests use Satterthwaite&#39;s method [
## lmerModLmerTest]
## Formula: lezu ~ 1 + (1 | nation)
##    Data: kultur
## 
## REML criterion at convergence: 21954.9
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -3.8470 -0.6650  0.0939  0.7345  3.3902 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  nation   (Intercept) 0.2854   0.5342  
##  Residual             1.2296   1.1089  
## Number of obs: 7163, groups:  nation, 40
## 
## Fixed effects:
##             Estimate Std. Error       df t value Pr(&gt;|t|)    
## (Intercept)  4.39599    0.08581 39.05402   51.23   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
</div>
</div>
<div id="zufällige-effekte" class="section level2">
<h2>Zufällige Effekte</h2>
<pre class="r"><code>summary(mod0)$var</code></pre>
<pre><code>##  Groups   Name        Std.Dev.
##  nation   (Intercept) 0.53423 
##  Residual             1.10885</code></pre>
<ul>
<li>Darstellung der Ergebnisse in <code>sjPlot</code>
<ul>
<li>gibt <code>ggplot</code> Objekt aus, sodass damit alle üblichen Anpassungen vorgenommen werden können</li>
</ul></li>
</ul>
<pre class="r"><code>library(sjPlot)
plot_model(mod0, type = &#39;re&#39;, sort.est = &#39;(Intercept)&#39;) + 
  ggplot2::theme_minimal()</code></pre>
<p><img src="/post/2023-02-23-KiJu_LMMsQuer_files/figure-html/caterpillar-mod0-1.png" width="672" /></p>
<ul>
<li>Einzelne Werte abrufen (für weitere Verarbeitung)</li>
</ul>
<pre class="r"><code>ranef(mod0)</code></pre>
<pre><code>## $nation
##             (Intercept)
## Turkey      -0.44818086
## Korea       -0.40503647
## Slovenia     0.56208695
## Nigeria     -0.17616391
## Japan       -0.56699431
## Chile        0.86978321
## China       -1.18650851
## Thailand    -0.45861364
## Australia    0.48105911
## Hong Kong   -0.21362638
## Iran        -0.48112865
## Greece       0.14584524
## Philippines  0.15297260
## Nepal       -0.58509359
## Cyprus       0.10940207
## Indonesia    0.10703558
## Mexico       0.58950252
## Belgium      0.48558728
## Portugal     0.35390197
## Uganda      -1.15522933
## Singapore   -0.34397158
## Netherlands  0.52671074
## Malaysia     0.29471140
## Georgia     -0.67191598
## Croatia      0.17087872
## Ghana       -0.20139742
## Bulgaria    -0.29096543
## Bangladesh   0.05749552
## Russia       0.05460689
## Slovakia    -0.12780524
## Zimbabwe    -0.09329670
## Germany      0.46822898
## Kuwait       0.10655340
## Columbia     0.49243158
## Brazil       0.46243395
## Cameroon    -0.91203076
## Canada       1.09983334
## India       -0.26631345
## S. Africa    0.52621827
## Austria      0.46699289
## 
## with conditional variances for &quot;nation&quot;</code></pre>
<div id="icc" class="section level3">
<h3>ICC</h3>
<p><span class="math display">\[
  ICC = \rho(y_{ij}, y_{i&#39;j}) = \frac{var(u_{0j})}{var(y_{ij})} = \frac{\sigma^2_{u_{0j}}}{\sigma^2_{u_{0j}} + \sigma^2_{r_{ij}}}
\]</span></p>
<ul>
<li>händisch berechnen:</li>
</ul>
<pre class="r"><code>tmp &lt;- VarCorr(mod0) |&gt; as.data.frame()
tmp$vcov[1] / sum(tmp$vcov)</code></pre>
<pre><code>## [1] 0.1883886</code></pre>
<ul>
<li>in <code>jtools</code></li>
</ul>
<pre class="r"><code>library(jtools)
print(summ(mod0))</code></pre>
<pre><code>## MODEL INFO:
## Observations: 7163
## Dependent Variable: lezu
## Type: Mixed effects linear regression 
## 
## MODEL FIT:
## AIC = 21960.88, BIC = 21981.51
## Pseudo-R² (fixed effects) = 0.00
## Pseudo-R² (total) = 0.19 
## 
## FIXED EFFECTS:
## -------------------------------------------------------
##                     Est.   S.E.   t val.    d.f.      p
## ----------------- ------ ------ -------- ------- ------
## (Intercept)         4.40   0.09    51.23   39.05   0.00
## -------------------------------------------------------
## 
## p values calculated using Satterthwaite d.f.
## 
## RANDOM EFFECTS:
## ------------------------------------
##   Group      Parameter    Std. Dev. 
## ---------- ------------- -----------
##   nation    (Intercept)     0.53    
##  Residual                   1.11    
## ------------------------------------
## 
## Grouping variables:
## --------------------------
##  Group    # groups   ICC  
## -------- ---------- ------
##  nation      40      0.19 
## --------------------------</code></pre>
<ul>
<li>Wenn <span class="math inline">\(ICC &gt; 0\)</span>, ist die Annahme der Unabhängigkeit verletzt und es wird ein Multilevel-Modell benötigt</li>
<li>Wenn <span class="math inline">\(ICC &gt; 0\)</span> können dennoch Gruppenunterschiede bzgl. der <em>Regressionsgewichte</em> bestehen</li>
<li>Häufig wird <span class="math inline">\(ICC &gt;.10\)</span> als Cut-Off Kriterium gewertet
<ul>
<li>Schon bei kleinen Werten, kann Clusterung zur starken Überschätzung der Power führen</li>
</ul></li>
<li>Forschungsbereich Bildung und Organisationen:
<ul>
<li>klein: .05, mittel: .10, groß: .15</li>
</ul></li>
<li>Forschungsbereich kleine Gruppen und Familien:
<ul>
<li>klein: .10, mittel: .20, groß: .30</li>
</ul></li>
<li>Generell: je größer die Gruppen desto kleiner ICC per Zufall</li>
<li>Effektive Stichprobengröße:
<span class="math display">\[
n_{\text{eff}} = \frac{n}{1 + (n_{\text{clus}} - 1)ICC}
\]</span></li>
</ul>
</div>
</div>
<div id="level-1-prädiktoren" class="section level2">
<h2>Level-1 Prädiktoren</h2>
<div id="random-intercept-model" class="section level3">
<h3>Random Intercept Model</h3>
<p><strong>Level 1</strong>
<span class="math display">\[ y_{ij} = \beta_{0j} + \beta_{1j}x_{ij} + r_{ij} \]</span></p>
<p><strong>Level 2</strong>
<span class="math display">\[ \beta_{0j} = \gamma_{00} + u_{0j} \]</span>
<span class="math display">\[ \beta_{1j} = \gamma_{10} \]</span></p>
<p><strong>Gesamtgleichung</strong>
<span class="math display">\[ y_{ij} = \gamma_{00} + \gamma_{10}x_{ij} + u_{0j} + r_{ij} \]</span></p>
<p>Vergleich der Parameterinterpretation:</p>
<ul>
<li>Nullmodell
<ul>
<li><span class="math inline">\(\gamma_{00}\)</span> Erwartungswert der Gruppenerwartungswerte</li>
<li><span class="math inline">\(r_{ij}\)</span> Abweichung eines individuellen Wertes vom jeweiligen Gruppenerwartungswert</li>
<li><span class="math inline">\(u_{0j}\)</span> u0j Abweichung eines Gruppenerwartungswert vom Erwartungswert der Gruppenerwartungswerte</li>
</ul></li>
<li>Random Intercept Modell
<ul>
<li><span class="math inline">\(\gamma_{00}\)</span> Mittleres Intercept</li>
<li><span class="math inline">\(r_{ij}\)</span> Abweichung eines individuellen Wertes von der gruppenspezifische Regressionsgeraden bzw. vom vorhergesagten Wert</li>
<li><span class="math inline">\(u_{0j}\)</span> Abweichung eines gruppenspezifischen Intercepts vom mittleren Intercept</li>
</ul></li>
<li>Modell in <code>lme4</code> Aufstellen</li>
</ul>
<pre class="r"><code>mod1 &lt;- lmer(lezu ~ 1 + pa + (1 | nation), kultur)
print(summ(mod1))</code></pre>
<pre><code>## MODEL INFO:
## Observations: 7141
## Dependent Variable: lezu
## Type: Mixed effects linear regression 
## 
## MODEL FIT:
## AIC = 20481.85, BIC = 20509.35
## Pseudo-R² (fixed effects) = 0.18
## Pseudo-R² (total) = 0.31 
## 
## FIXED EFFECTS:
## ---------------------------------------------------------
##                     Est.   S.E.   t val.      d.f.      p
## ----------------- ------ ------ -------- --------- ------
## (Intercept)         2.50   0.09    29.35     82.79   0.00
## pa                  0.35   0.01    39.64   7137.96   0.00
## ---------------------------------------------------------
## 
## p values calculated using Satterthwaite d.f.
## 
## RANDOM EFFECTS:
## ------------------------------------
##   Group      Parameter    Std. Dev. 
## ---------- ------------- -----------
##   nation    (Intercept)     0.44    
##  Residual                   1.00    
## ------------------------------------
## 
## Grouping variables:
## --------------------------
##  Group    # groups   ICC  
## -------- ---------- ------
##  nation      40      0.16 
## --------------------------</code></pre>
</div>
<div id="grafische-darstellung" class="section level3">
<h3>Grafische Darstellung</h3>
<pre class="r"><code>plot_model(mod1, type = &#39;re&#39;, sort.est = &#39;(Intercept)&#39;)</code></pre>
<p><img src="/post/2023-02-23-KiJu_LMMsQuer_files/figure-html/caterpillar-mod1-1.png" width="672" /></p>
</div>
<div id="mehrere-prädiktoren" class="section level3">
<h3>Mehrere Prädiktoren</h3>
<ul>
<li><em>Übungsaufgabe</em>: positiven und negativen Affekt aufnehmen
<ul>
<li>Was ist bedeutsam in der Vorhersage der Lebenszufriedenheit?</li>
</ul></li>
</ul>
<pre class="r"><code>mod2 &lt;- lmer(lezu ~ 1 + pa + na + (1 | nation), kultur)
print(summ(mod2))</code></pre>
<pre><code>## MODEL INFO:
## Observations: 7134
## Dependent Variable: lezu
## Type: Mixed effects linear regression 
## 
## MODEL FIT:
## AIC = 20140.59, BIC = 20174.96
## Pseudo-R² (fixed effects) = 0.21
## Pseudo-R² (total) = 0.34 
## 
## FIXED EFFECTS:
## ----------------------------------------------------------
##                      Est.   S.E.   t val.      d.f.      p
## ----------------- ------- ------ -------- --------- ------
## (Intercept)          3.34   0.10    35.04    137.11   0.00
## pa                   0.31   0.01    35.49   7130.58   0.00
## na                  -0.18   0.01   -18.45   7126.81   0.00
## ----------------------------------------------------------
## 
## p values calculated using Satterthwaite d.f.
## 
## RANDOM EFFECTS:
## ------------------------------------
##   Group      Parameter    Std. Dev. 
## ---------- ------------- -----------
##   nation    (Intercept)     0.43    
##  Residual                   0.98    
## ------------------------------------
## 
## Grouping variables:
## --------------------------
##  Group    # groups   ICC  
## -------- ---------- ------
##  nation      40      0.16 
## --------------------------</code></pre>
</div>
<div id="prüfung-via-modellvergleich" class="section level3">
<h3>Prüfung via Modellvergleich</h3>
<pre class="r"><code>anova(mod0, mod1, mod2)</code></pre>
<pre><code>## Error in anova.merMod(mod0, mod1, mod2): models were not all fitted to the same size of dataset</code></pre>
<ul>
<li>Fehlende Werte auf den UVs verändern Größe des Datensatzes</li>
</ul>
<pre class="r"><code>kultur_comp &lt;- mod2@frame
mod0_u &lt;- update(mod0, data = kultur_comp)
mod1_u &lt;- update(mod1, data = kultur_comp)
mod2_u &lt;- update(mod2, data = kultur_comp)</code></pre>
<pre class="r"><code>anova(mod0_u, mod1_u, mod2_u)</code></pre>
<pre><code>## refitting model(s) with ML (instead of REML)</code></pre>
<pre><code>## Data: kultur_comp
## Models:
## mod0_u: lezu ~ 1 + (1 | nation)
## mod1_u: lezu ~ 1 + pa + (1 | nation)
## mod2_u: lezu ~ 1 + pa + na + (1 | nation)
##        npar   AIC   BIC logLik deviance   Chisq Df Pr(&gt;Chisq)    
## mod0_u    3 21868 21889 -10931    21862                          
## mod1_u    4 20453 20480 -10222    20445 1417.51  1  &lt; 2.2e-16 ***
## mod2_u    5 20122 20156 -10056    20112  332.65  1  &lt; 2.2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
</div>
<div id="random-slopes-modelle" class="section level3">
<h3>Random Slopes Modelle</h3>
<p><strong>Level 1</strong>
<span class="math display">\[ y_{ij} = \beta_{0j} + \beta_{1j}x_{1ij} + \beta_{2j}x_{2ij} + r_{ij} \]</span></p>
<p><strong>Level 2</strong>
<span class="math display">\[ \beta_{0j} = \gamma_{00} + u_{0j} \]</span>
<span class="math display">\[ \beta_{1j} = \gamma_{10} + u_{1j} \]</span>
<span class="math display">\[ \beta_{2j} = \gamma_{20} + u_{2j} \]</span></p>
<p><strong>Gesamtgleichung</strong>
<span class="math display">\[ y_{ij} = \gamma_{00} + \gamma_{10}x_{1ij} + \gamma_{20}x_{2ij} + u_{0j} + u_{1j}x_{1ij} + u_{2j}x_{2ij} + r_{ij} \]</span></p>
<pre class="r"><code>mod3 &lt;- lmer(lezu ~ 1 + pa + na + (1 + pa + na | nation), kultur)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl = control$checkConv, :
## Model failed to converge with max|grad| = 0.00698484 (tol = 0.002, component 1)</code></pre>
<ul>
<li>Fehlende Konvergenz des Modells
<ul>
<li>sehr kleine Zufallseffekte</li>
<li>sehr hohe Korrelationen zwischen Zufallseffekten</li>
<li>hohe Modellkomplexität</li>
<li>in jedem Fall: inhaltliche Diagnostik betreiben!</li>
</ul></li>
</ul>
<pre class="r"><code># Optimizer wechseln, langsamer aber Versuch Konvergenz zu erreichen
opts &lt;- lmerControl(optimizer = &#39;bobyqa&#39;)
mod3 &lt;- lmer(lezu ~ 1 + pa + na + (1 + pa + na | nation), kultur, control = opts)</code></pre>
<pre class="r"><code>print(summ(mod3))</code></pre>
<pre><code>## MODEL INFO:
## Observations: 7134
## Dependent Variable: lezu
## Type: Mixed effects linear regression 
## 
## MODEL FIT:
## AIC = 20092.97, BIC = 20161.69
## Pseudo-R² (fixed effects) = 0.21
## Pseudo-R² (total) = 0.35 
## 
## FIXED EFFECTS:
## --------------------------------------------------------
##                      Est.   S.E.   t val.    d.f.      p
## ----------------- ------- ------ -------- ------- ------
## (Intercept)          3.38   0.10    33.31   39.77   0.00
## pa                   0.31   0.01    21.44   37.36   0.00
## na                  -0.18   0.02   -11.26   35.54   0.00
## --------------------------------------------------------
## 
## p values calculated using Satterthwaite d.f.
## 
## RANDOM EFFECTS:
## ------------------------------------
##   Group      Parameter    Std. Dev. 
## ---------- ------------- -----------
##   nation    (Intercept)     0.46    
##   nation        pa          0.07    
##   nation        na          0.08    
##  Residual                   0.97    
## ------------------------------------
## 
## Grouping variables:
## --------------------------
##  Group    # groups   ICC  
## -------- ---------- ------
##  nation      40      0.18 
## --------------------------</code></pre>
<ul>
<li>Gibt leider Korrelationen zwischen REs nicht aus</li>
</ul>
<pre class="r"><code>summary(mod3)$varcor</code></pre>
<pre><code>##  Groups   Name        Std.Dev. Corr         
##  nation   (Intercept) 0.461841              
##           pa          0.068146 -0.201       
##           na          0.078971 -0.545 -0.170
##  Residual             0.972926</code></pre>
</div>
</div>
