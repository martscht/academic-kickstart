---
title: Einführung in gemischte Modelle mit lme4
date: '2023-02-23'
slug: lmm-intro
categories: ["KiJu"]
tags: ["Regression", "Hierarchische Daten", "Zufallseffekte"]
subtitle: ''
summary: ''
authors: [schultze]
lastmod: '2023-02-23T16:20:00+01:00'
featured: no
header:
  image: "/header/KiJu_LMMsQuer.jpg"
  caption: "[Courtesy of pexels](https://www.pexels.com/photo/bunches-of-grapes-hanging-from-vines-3840335/)"
projects: []
---



<div id="vorbereitung" class="section level2">
<h2>Vorbereitung</h2>
<div id="datenbeispiel" class="section level3">
<h3>Datenbeispiel</h3>
<ul>
<li>International College Survey (Diener, Kim-Pietro, Scollon, et al., 2001)</li>
<li>Wohlbefinden in unterschiedlichen Ländern</li>
</ul>
<pre class="r"><code>load(url(&#39;https://pandar.netlify.app/post/kultur.rda&#39;))
head(kultur)[, 1:8] # alle Zeilen und Spalten 1-8 für die ersten 6 Personen</code></pre>
<pre><code>##   nation female auf_e kla_e lezu       pa    na         bal
## 1 Turkey   male   3.0   3.0  4.0 4.333333 4.250  0.08333333
## 2 Turkey female   2.5   2.5  5.6 5.333333 7.375 -2.04166667
## 3 Turkey female   3.0   3.0  4.0 5.666667 2.000  3.66666667
## 4 Turkey female   3.5   3.0  2.4 3.833333 5.000 -1.16666667
## 5 Turkey female   3.5   2.5  2.0 5.666667 6.125 -0.45833333
## 6 Turkey   male   3.0   3.0  4.4 6.666667 4.500  2.16666667</code></pre>
<ul>
<li>Lebenszufriedenheit (lezu)
<ul>
<li>5 Items auf einer Skala von 1 (“strongly disagree”) bis 7 (“strongly agree”)</li>
<li>z.B. “I am satisfied with my life”</li>
</ul></li>
<li>Positiver Affekt (pa) &amp; negativer Affekt (na)
<ul>
<li>“For the following list of emotions, please rate how often you felt each of the emotions in the last week”</li>
<li>Skala von 1 (“not at all”) bis 7 (“all the time”)</li>
<li>Für positiven Affekt: Pleasant, Happy, Cheerful, etc.</li>
<li>Für negativen Affekt: Unpleasant, Sad, Anger, etc.</li>
</ul></li>
<li>Klarheit eigener Gefühle (kla_e)</li>
<li>Aufmerksamkeit auf eigene Gefühle (auf_e)</li>
<li>Schachtelung in Nationen (nation)</li>
</ul>
<pre class="r"><code>levels(kultur$nation) # Übersicht über alle vorkommenden Nationen</code></pre>
<pre><code>##  [1] &quot;Turkey&quot;      &quot;Korea&quot;       &quot;Slovenia&quot;    &quot;Nigeria&quot;     &quot;Japan&quot;      
##  [6] &quot;Chile&quot;       &quot;China&quot;       &quot;Thailand&quot;    &quot;Australia&quot;   &quot;Hong Kong&quot;  
## [11] &quot;Iran&quot;        &quot;Greece&quot;      &quot;Philippines&quot; &quot;Nepal&quot;       &quot;Cyprus&quot;     
## [16] &quot;Indonesia&quot;   &quot;Mexico&quot;      &quot;Belgium&quot;     &quot;Portugal&quot;    &quot;Uganda&quot;     
## [21] &quot;Singapore&quot;   &quot;Netherlands&quot; &quot;Malaysia&quot;    &quot;Georgia&quot;     &quot;Croatia&quot;    
## [26] &quot;Ghana&quot;       &quot;Bulgaria&quot;    &quot;Bangladesh&quot;  &quot;Russia&quot;      &quot;Slovakia&quot;   
## [31] &quot;Zimbabwe&quot;    &quot;Germany&quot;     &quot;Kuwait&quot;      &quot;Columbia&quot;    &quot;Brazil&quot;     
## [36] &quot;Cameroon&quot;    &quot;Canada&quot;      &quot;India&quot;       &quot;S. Africa&quot;   &quot;Austria&quot;</code></pre>
<pre class="r"><code>dim(kultur) # Anzahl Zeilen und Spalten des ganzen Datensatzes</code></pre>
<pre><code>## [1] 7194   16</code></pre>
</div>
<div id="regressionsergebnisse-im-beispiel" class="section level3">
<h3>Regressionsergebnisse im Beispiel</h3>
<pre class="r"><code>mod &lt;- lm(lezu ~ 1 + pa, kultur) # Interzept wird hier explizit angefordert
summary(mod)</code></pre>
<pre><code>## 
## Call:
## lm(formula = lezu ~ 1 + pa, data = kultur)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -4.4262 -0.7588  0.1076  0.7743  3.0413 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 2.225025   0.049592   44.87   &lt;2e-16 ***
## pa          0.400132   0.008679   46.10   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1.086 on 7139 degrees of freedom
##   (53 observations deleted due to missingness)
## Multiple R-squared:  0.2294, Adjusted R-squared:  0.2293 
## F-statistic:  2126 on 1 and 7139 DF,  p-value: &lt; 2.2e-16</code></pre>
<ul>
<li>Darstellung der Ergebnisse (siehe <a href="https://pandar.netlify.app/extras/#ggplotting">ggplotting unter Extras</a>)</li>
</ul>
<pre class="r"><code>library(ggplot2)
ggplot(kultur, aes(x = pa, y = lezu)) + 
  geom_point() +
  geom_abline(intercept = coef(mod)[1], slope = coef(mod)[2], color = &#39;blue&#39;) +
  theme_minimal()</code></pre>
<pre><code>## Warning: Removed 53 rows containing missing values (`geom_point()`).</code></pre>
<p><img src="/post/2023-02-23-KiJu_LMMsQuer_files/figure-html/scatter-reg-1.png" width="672" /></p>
<ul>
<li>R-Funktionen für Regression</li>
</ul>
<table>
<thead>
<tr class="header">
<th>Befehl</th>
<th>Funktionalität</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>summary()</code></td>
<td>Zusammenfassung der Ergebnisse</td>
</tr>
<tr class="even">
<td><code>coef()</code></td>
<td>Koeffizienten ausgeben lassen</td>
</tr>
<tr class="odd">
<td><code>confint()</code></td>
<td>Konfidenzintervalle für Koeffizienten</td>
</tr>
<tr class="even">
<td><code>resid()</code></td>
<td>Ausgabe der <span class="math inline">\(e_{i}\)</span></td>
</tr>
<tr class="odd">
<td><code>predict()</code></td>
<td>Ausgabe der <span class="math inline">\(\hat{y}_i\)</span></td>
</tr>
<tr class="even">
<td><code>anova()</code></td>
<td>Modellvergleiche</td>
</tr>
<tr class="odd">
<td><code>plot()</code></td>
<td>Residuenplots zur Diagnostik</td>
</tr>
</tbody>
</table>
</div>
<div id="pakete" class="section level3">
<h3>Pakete</h3>
<pre class="r"><code># Für Plots der Modelle - dauert einen Moment
install.packages(&#39;sjPlot&#39;, dependencies = TRUE)

# Für eine erweiterte Modellzusammenfassung
installpackages(&#39;jtools&#39;)</code></pre>
<p>Für alternative Ansätze der Darstellung bzw. Berechnung von Komponenten (nur in vereinzelten Beispielen genutzt)</p>
<pre class="r"><code># Für Inferenz der fixed effects
install.packages(&#39;lmerTest&#39;)

# Für Bestimmung von Pseudo R^2
install.packages(&#39;MuMIn&#39;)</code></pre>
</div>
</div>
<div id="hintergrund-zu-lmms" class="section level2">
<h2>Hintergrund zu LMMs</h2>
<ul>
<li><p>Verletzung der Annahme unabhängiger Beobachtungen</p>
<ul>
<li>Varianz kleiner als bei Zufallsstichprobe (wegen Abhängigkeiten)</li>
<li>Effektives <span class="math inline">\(n\)</span> überschätzt</li>
<li>Präzision der Effekte überschätzt (SE unterschätzt)</li>
</ul></li>
<li><p>Koeffizienten nicht verzerrt, aber gemischt</p>
<ul>
<li>Risiko falscher Schlüsse</li>
</ul></li>
<li><p>Für Umgang mit Voraussetzungsverletzung ist Korrektur der SE ausreichend</p></li>
<li><p>Für korrekte Zerlegung von Effekten und deren Wirkebene: LMMs</p></li>
<li><p>Feste Effekte (Kodiervariablen)</p>
<ul>
<li>Aussagen über einzelne Ausprägungen relevant</li>
<li>Durch Studiendesign festgelegt oder natürliche Gruppen</li>
<li>Geschlecht, Therapieansätze, Schulformen</li>
</ul></li>
<li><p>Zufällige Effekte (LMMs)</p>
<ul>
<li>Zusammenfassende Aussagen über viele Ausprägungen relevant</li>
<li>Per Zufall aus Population gezogen</li>
<li>Schulklasse, Therapeut:innen, Teams</li>
</ul></li>
<li><p>Übliche Begriffe</p>
<ul>
<li>Mehrebenenmodelle</li>
<li>Gemischte Modelle (LMMs)</li>
<li>Hierarchische Modelle</li>
</ul></li>
</ul>
<table>
<thead>
<tr class="header">
<th>Level 2</th>
<th>Level 1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>macro-units</td>
<td>micro-units</td>
</tr>
<tr class="even">
<td>primary units</td>
<td>secondary units</td>
</tr>
<tr class="odd">
<td>clusters</td>
<td>elementary units</td>
</tr>
<tr class="even">
<td>between level</td>
<td>within level</td>
</tr>
</tbody>
</table>
</div>
<div id="nullmodell" class="section level2">
<h2>Nullmodell</h2>
<div id="notation" class="section level3">
<h3>Notation</h3>
<table>
<thead>
<tr class="header">
<th>Notation</th>
<th>Bedeutung</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(y_{ij}\)</span></td>
<td>AV-Wert von Person <span class="math inline">\(i\)</span> in Cluster <span class="math inline">\(j\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\(r_{ij}\)</span></td>
<td>Residuum auf L1, Abweichung der Person von Vorhersage</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(u_{0j}\)</span></td>
<td>Residuum auf L2, Abweichung des Clusters von Vorhersage</td>
</tr>
<tr class="even">
<td><span class="math inline">\(\beta_{0j}\)</span></td>
<td>(bedingter) Erwartungswert für Cluster <span class="math inline">\(j\)</span></td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\gamma_{00}\)</span></td>
<td>Erwartungswert der Erwartungswerte über alle Cluster</td>
</tr>
</tbody>
</table>
<p><strong>Level 1</strong>
<span class="math display">\[ y_{ij} = \beta_{0j} + r_{ij} \]</span></p>
<p><strong>Level 2</strong>
<span class="math display">\[ \beta_{0j} = \gamma_{00} + u_{0j} \]</span></p>
<p><strong>Gesamtgleichung</strong>
<span class="math display">\[ y_{ij} = \gamma_{00} + u_{0j} + r_{ij} \]</span></p>
</div>
<div id="nullmodell-in-lme4" class="section level3">
<h3>Nullmodell in lme4</h3>
<pre class="r"><code>library(lme4)</code></pre>
<pre><code>## Loading required package: Matrix</code></pre>
<pre class="r"><code>mod0 &lt;- lmer(lezu ~ 1 + (1 | nation), kultur)</code></pre>
<p>Generelle Schreibweise:</p>
<ul>
<li><code>lmer</code>: <em>linear mixed effects regression</em></li>
<li><code>AV ~ UV</code>: wie in <code>lm</code></li>
<li><code>(RE | Cluster)</code>: Welcher Parameter (<code>RE</code>) soll über die Cluster variieren dürfen</li>
</ul>
<pre class="r"><code>summary(mod0)</code></pre>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: lezu ~ 1 + (1 | nation)
##    Data: kultur
## 
## REML criterion at convergence: 21954.9
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -3.8470 -0.6650  0.0939  0.7345  3.3902 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  nation   (Intercept) 0.2854   0.5342  
##  Residual             1.2296   1.1089  
## Number of obs: 7163, groups:  nation, 40
## 
## Fixed effects:
##             Estimate Std. Error t value
## (Intercept)  4.39599    0.08581   51.23</code></pre>
</div>
<div id="inferenzstatistik-in-lme4" class="section level3">
<h3>Inferenzstatistik in lme4</h3>
<pre class="r"><code>confint(mod0)</code></pre>
<pre><code>## Computing profile confidence intervals ...</code></pre>
<pre><code>##                 2.5 %    97.5 %
## .sig01      0.4264675 0.6719161
## .sigma      1.0908914 1.1273144
## (Intercept) 4.2259305 4.5662197</code></pre>
<pre class="r"><code>library(lmerTest)</code></pre>
<pre><code>## 
## Attaching package: &#39;lmerTest&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:lme4&#39;:
## 
##     lmer</code></pre>
<pre><code>## The following object is masked from &#39;package:stats&#39;:
## 
##     step</code></pre>
<pre class="r"><code>mod0 &lt;- lmer(lezu ~ 1 + (1 | nation), kultur)
summary(mod0)</code></pre>
<pre><code>## Linear mixed model fit by REML. t-tests use Satterthwaite&#39;s method [
## lmerModLmerTest]
## Formula: lezu ~ 1 + (1 | nation)
##    Data: kultur
## 
## REML criterion at convergence: 21954.9
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -3.8470 -0.6650  0.0939  0.7345  3.3902 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  nation   (Intercept) 0.2854   0.5342  
##  Residual             1.2296   1.1089  
## Number of obs: 7163, groups:  nation, 40
## 
## Fixed effects:
##             Estimate Std. Error       df t value Pr(&gt;|t|)    
## (Intercept)  4.39599    0.08581 39.05387   51.23   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
</div>
</div>
<div id="zufällige-effekte" class="section level2">
<h2>Zufällige Effekte</h2>
<pre class="r"><code>summary(mod0)$var</code></pre>
<pre><code>##  Groups   Name        Std.Dev.
##  nation   (Intercept) 0.53423 
##  Residual             1.10885</code></pre>
<ul>
<li>Darstellung der Ergebnisse in <code>sjPlot</code>
<ul>
<li>gibt <code>ggplot</code> Objekt aus, sodass damit alle üblichen Anpassungen vorgenommen werden können</li>
</ul></li>
</ul>
<pre class="r"><code>library(sjPlot)
plot_model(mod0, type = &#39;re&#39;, sort.est = &#39;(Intercept)&#39;) +  # Plot für Random Effects (re), sortiert nach Schätzung (est) der Interzept (&#39;(Intercept)&#39;)
  ggplot2::theme_minimal() # Layout</code></pre>
<pre><code>## Warning in checkMatrixPackageVersion(): Package version inconsistency detected.
## TMB was built with Matrix version 1.5.3
## Current Matrix version is 1.5.1
## Please re-install &#39;TMB&#39; from source using install.packages(&#39;TMB&#39;, type = &#39;source&#39;) or ask CRAN for a binary version of &#39;TMB&#39; matching CRAN&#39;s &#39;Matrix&#39; package</code></pre>
<pre><code>## Warning in checkDepPackageVersion(dep_pkg = &quot;TMB&quot;): Package version inconsistency detected.
## glmmTMB was built with TMB version 1.9.1
## Current TMB version is 1.9.2
## Please re-install glmmTMB from source or restore original &#39;TMB&#39; package (see &#39;?reinstalling&#39; for more information)</code></pre>
<p><img src="/post/2023-02-23-KiJu_LMMsQuer_files/figure-html/caterpillar-mod0-1.png" width="672" /></p>
<pre class="r"><code># Breite der Fehlerbalken hängt mit Stichprobengröße zusammen</code></pre>
<ul>
<li>Einzelne Werte abrufen (für weitere Verarbeitung)</li>
</ul>
<pre class="r"><code>ranef(mod0)</code></pre>
<pre><code>## $nation
##             (Intercept)
## Turkey      -0.44818090
## Korea       -0.40503650
## Slovenia     0.56208697
## Nigeria     -0.17616392
## Japan       -0.56699435
## Chile        0.86978323
## China       -1.18650855
## Thailand    -0.45861367
## Australia    0.48105914
## Hong Kong   -0.21362639
## Iran        -0.48112868
## Greece       0.14584524
## Philippines  0.15297260
## Nepal       -0.58509366
## Cyprus       0.10940208
## Indonesia    0.10703558
## Mexico       0.58950254
## Belgium      0.48558732
## Portugal     0.35390199
## Uganda      -1.15522944
## Singapore   -0.34397163
## Netherlands  0.52671088
## Malaysia     0.29471141
## Georgia     -0.67191605
## Croatia      0.17087873
## Ghana       -0.20139744
## Bulgaria    -0.29096546
## Bangladesh   0.05749553
## Russia       0.05460690
## Slovakia    -0.12780526
## Zimbabwe    -0.09329672
## Germany      0.46822901
## Kuwait       0.10655341
## Columbia     0.49243159
## Brazil       0.46243397
## Cameroon    -0.91203084
## Canada       1.09983346
## India       -0.26631347
## S. Africa    0.52621843
## Austria      0.46699293
## 
## with conditional variances for &quot;nation&quot;</code></pre>
<div id="icc" class="section level3">
<h3>ICC</h3>
<p><span class="math display">\[
  ICC = \rho(y_{ij}, y_{i&#39;j}) = \frac{var(u_{0j})}{var(y_{ij})} = \frac{\sigma^2_{u_{0j}}}{\sigma^2_{u_{0j}} + \sigma^2_{r_{ij}}}
\]</span></p>
<ul>
<li>händisch berechnen:</li>
</ul>
<pre class="r"><code>tmp &lt;- VarCorr(mod0) |&gt; as.data.frame()
tmp$vcov[1] / sum(tmp$vcov)</code></pre>
<pre><code>## [1] 0.188389</code></pre>
<ul>
<li>in <code>jtools</code></li>
</ul>
<pre class="r"><code>library(jtools)
print(summ(mod0))</code></pre>
<pre><code>## MODEL INFO:
## Observations: 7163
## Dependent Variable: lezu
## Type: Mixed effects linear regression 
## 
## MODEL FIT:
## AIC = 21960.88, BIC = 21981.51
## Pseudo-R² (fixed effects) = 0.00
## Pseudo-R² (total) = 0.19 
## 
## FIXED EFFECTS:
## -------------------------------------------------------
##                     Est.   S.E.   t val.    d.f.      p
## ----------------- ------ ------ -------- ------- ------
## (Intercept)         4.40   0.09    51.23   39.05   0.00
## -------------------------------------------------------
## 
## p values calculated using Satterthwaite d.f.
## 
## RANDOM EFFECTS:
## ------------------------------------
##   Group      Parameter    Std. Dev. 
## ---------- ------------- -----------
##   nation    (Intercept)     0.53    
##  Residual                   1.11    
## ------------------------------------
## 
## Grouping variables:
## --------------------------
##  Group    # groups   ICC  
## -------- ---------- ------
##  nation      40      0.19 
## --------------------------</code></pre>
<ul>
<li>Wenn <span class="math inline">\(ICC &gt; 0\)</span>, ist die Annahme der Unabhängigkeit verletzt und es wird ein Multilevel-Modell benötigt</li>
<li>Wenn <span class="math inline">\(ICC &gt; 0\)</span> können dennoch Gruppenunterschiede bzgl. der <em>Regressionsgewichte</em> bestehen</li>
<li>Häufig wird <span class="math inline">\(ICC &gt;.10\)</span> als Cut-Off Kriterium gewertet
<ul>
<li>Schon bei kleinen Werten, kann Clusterung zur starken Überschätzung der Power führen</li>
</ul></li>
<li>Forschungsbereich Bildung und Organisationen:
<ul>
<li>klein: .05, mittel: .10, groß: .15</li>
</ul></li>
<li>Forschungsbereich kleine Gruppen und Familien:
<ul>
<li>klein: .10, mittel: .20, groß: .30</li>
</ul></li>
<li>Generell: je größer die Gruppen desto kleiner ICC per Zufall</li>
<li>Effektive Stichprobengröße:
<span class="math display">\[
n_{\text{eff}} = \frac{n}{1 + (n_{\text{clus}} - 1)ICC}
\]</span></li>
</ul>
</div>
</div>
<div id="level-1-prädiktoren" class="section level2">
<h2>Level-1 Prädiktoren</h2>
<div id="random-intercept-model" class="section level3">
<h3>Random Intercept Model</h3>
<p><strong>Level 1</strong>
<span class="math display">\[ y_{ij} = \beta_{0j} + \beta_{1j}x_{ij} + r_{ij} \]</span></p>
<p><strong>Level 2</strong>
<span class="math display">\[ \beta_{0j} = \gamma_{00} + u_{0j} \]</span>
<span class="math display">\[ \beta_{1j} = \gamma_{10} \]</span></p>
<p><strong>Gesamtgleichung</strong>
<span class="math display">\[ y_{ij} = \gamma_{00} + \gamma_{10}x_{ij} + u_{0j} + r_{ij} \]</span></p>
<p>Vergleich der Parameterinterpretation:</p>
<ul>
<li>Nullmodell
<ul>
<li><span class="math inline">\(\gamma_{00}\)</span> Erwartungswert der Gruppenerwartungswerte</li>
<li><span class="math inline">\(r_{ij}\)</span> Abweichung eines individuellen Wertes vom jeweiligen Gruppenerwartungswert</li>
<li><span class="math inline">\(u_{0j}\)</span> u0j Abweichung eines Gruppenerwartungswert vom Erwartungswert der Gruppenerwartungswerte</li>
</ul></li>
<li>Random Intercept Modell
<ul>
<li><span class="math inline">\(\gamma_{00}\)</span> Mittleres Intercept</li>
<li><span class="math inline">\(r_{ij}\)</span> Abweichung eines individuellen Wertes von der gruppenspezifische Regressionsgeraden bzw. vom vorhergesagten Wert</li>
<li><span class="math inline">\(u_{0j}\)</span> Abweichung eines gruppenspezifischen Intercepts vom mittleren Intercept</li>
</ul></li>
<li>Modell in <code>lme4</code> Aufstellen</li>
</ul>
<pre class="r"><code>mod1 &lt;- lmer(lezu ~ 1 + pa + (1 | nation), kultur) # pa als Prädiktor zusätzlich aufnehmen
print(summ(mod1))</code></pre>
<pre><code>## MODEL INFO:
## Observations: 7141
## Dependent Variable: lezu
## Type: Mixed effects linear regression 
## 
## MODEL FIT:
## AIC = 20481.85, BIC = 20509.35
## Pseudo-R² (fixed effects) = 0.18
## Pseudo-R² (total) = 0.31 
## 
## FIXED EFFECTS:
## ---------------------------------------------------------
##                     Est.   S.E.   t val.      d.f.      p
## ----------------- ------ ------ -------- --------- ------
## (Intercept)         2.50   0.09    29.35     82.79   0.00
## pa                  0.35   0.01    39.64   7137.96   0.00
## ---------------------------------------------------------
## 
## p values calculated using Satterthwaite d.f.
## 
## RANDOM EFFECTS:
## ------------------------------------
##   Group      Parameter    Std. Dev. 
## ---------- ------------- -----------
##   nation    (Intercept)     0.44    
##  Residual                   1.00    
## ------------------------------------
## 
## Grouping variables:
## --------------------------
##  Group    # groups   ICC  
## -------- ---------- ------
##  nation      40      0.16 
## --------------------------</code></pre>
<pre class="r"><code>coef(mod1)$nation[&#39;Canada&#39;,] # spezifische Koeffizienten für Kanada auswählen</code></pre>
<pre><code>##        (Intercept)        pa
## Canada    3.391403 0.3490583</code></pre>
<pre class="r"><code>mod1b &lt;- lmer(lezu ~ 1 + pa + (1 + pa | nation), kultur) # Random Intercept Random Slope Modell
summ(mod1b)</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<tbody>
<tr>
<td style="text-align:left;font-weight: bold;">
Observations
</td>
<td style="text-align:right;">
7141
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
Dependent variable
</td>
<td style="text-align:right;">
lezu
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
Type
</td>
<td style="text-align:right;">
Mixed effects linear regression
</td>
</tr>
</tbody>
</table>
<table class="table table-striped table-hover table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<tbody>
<tr>
<td style="text-align:left;font-weight: bold;">
AIC
</td>
<td style="text-align:right;">
20440.39
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
BIC
</td>
<td style="text-align:right;">
20481.63
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
Pseudo-R² (fixed effects)
</td>
<td style="text-align:right;">
0.18
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
Pseudo-R² (total)
</td>
<td style="text-align:right;">
0.32
</td>
</tr>
</tbody>
</table>
<table class="table table-striped table-hover table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;border-bottom: 0;">
<thead>
<tr>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="6">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Fixed Effects
</div>
</th>
</tr>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Est.
</th>
<th style="text-align:right;">
S.E.
</th>
<th style="text-align:right;">
t val.
</th>
<th style="text-align:right;">
d.f.
</th>
<th style="text-align:right;">
p
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;font-weight: bold;">
(Intercept)
</td>
<td style="text-align:right;">
2.51
</td>
<td style="text-align:right;">
0.09
</td>
<td style="text-align:right;">
27.23
</td>
<td style="text-align:right;">
38.60
</td>
<td style="text-align:right;">
0.00
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
pa
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.02
</td>
<td style="text-align:right;">
21.82
</td>
<td style="text-align:right;">
38.56
</td>
<td style="text-align:right;">
0.00
</td>
</tr>
</tbody>
<tfoot>
<tr>
<td style="padding: 0; " colspan="100%">
<sup></sup> p values calculated using Satterthwaite d.f.
</td>
</tr>
</tfoot>
</table>
<table class="table table-striped table-hover table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Random Effects
</div>
</th>
</tr>
<tr>
<th>
Group
</th>
<th>
Parameter
</th>
<th>
Std. Dev.
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
nation
</td>
<td>
(Intercept)
</td>
<td>
0.47
</td>
</tr>
<tr>
<td>
nation
</td>
<td>
pa
</td>
<td>
0.08
</td>
</tr>
<tr>
<td>
Residual
</td>
<td>
</td>
<td>
1.00
</td>
</tr>
</tbody>
</table>
<table class="table table-striped table-hover table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Grouping Variables
</div>
</th>
</tr>
<tr>
<th>
Group
</th>
<th>
# groups
</th>
<th>
ICC
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
nation
</td>
<td>
40
</td>
<td>
0.18
</td>
</tr>
</tbody>
</table>
</div>
<div id="grafische-darstellung" class="section level3">
<h3>Grafische Darstellung</h3>
<pre class="r"><code>plot_model(mod1, type = &#39;re&#39;, sort.est = &#39;(Intercept)&#39;)</code></pre>
<p><img src="/post/2023-02-23-KiJu_LMMsQuer_files/figure-html/caterpillar-mod1-1.png" width="672" /></p>
</div>
<div id="mehrere-prädiktoren" class="section level3">
<h3>Mehrere Prädiktoren</h3>
<ul>
<li><em>Übungsaufgabe</em>: positiven und negativen Affekt aufnehmen
<ul>
<li>Was ist bedeutsam in der Vorhersage der Lebenszufriedenheit?</li>
</ul></li>
</ul>
<pre class="r"><code>mod2 &lt;- lmer(lezu ~ 1 + pa + na + (1 | nation), kultur)
print(summ(mod2))</code></pre>
<pre><code>## MODEL INFO:
## Observations: 7134
## Dependent Variable: lezu
## Type: Mixed effects linear regression 
## 
## MODEL FIT:
## AIC = 20140.59, BIC = 20174.96
## Pseudo-R² (fixed effects) = 0.21
## Pseudo-R² (total) = 0.34 
## 
## FIXED EFFECTS:
## ----------------------------------------------------------
##                      Est.   S.E.   t val.      d.f.      p
## ----------------- ------- ------ -------- --------- ------
## (Intercept)          3.34   0.10    35.04    137.11   0.00
## pa                   0.31   0.01    35.49   7130.58   0.00
## na                  -0.18   0.01   -18.45   7126.81   0.00
## ----------------------------------------------------------
## 
## p values calculated using Satterthwaite d.f.
## 
## RANDOM EFFECTS:
## ------------------------------------
##   Group      Parameter    Std. Dev. 
## ---------- ------------- -----------
##   nation    (Intercept)     0.43    
##  Residual                   0.98    
## ------------------------------------
## 
## Grouping variables:
## --------------------------
##  Group    # groups   ICC  
## -------- ---------- ------
##  nation      40      0.16 
## --------------------------</code></pre>
</div>
<div id="prüfung-via-modellvergleich" class="section level3">
<h3>Prüfung via Modellvergleich</h3>
<pre class="r"><code>anova(mod0, mod1, mod2)</code></pre>
<pre><code>## Error in anova.merMod(mod0, mod1, mod2): models were not all fitted to the same size of dataset</code></pre>
<ul>
<li>Fehlende Werte auf den UVs verändern Größe des Datensatzes</li>
</ul>
<pre class="r"><code>kultur_comp &lt;- mod2@frame
mod0_u &lt;- update(mod0, data = kultur_comp)
mod1_u &lt;- update(mod1, data = kultur_comp)
mod2_u &lt;- update(mod2, data = kultur_comp)</code></pre>
<pre class="r"><code>anova(mod0_u, mod1_u, mod2_u)</code></pre>
<pre><code>## refitting model(s) with ML (instead of REML)</code></pre>
<pre><code>## Data: kultur_comp
## Models:
## mod0_u: lezu ~ 1 + (1 | nation)
## mod1_u: lezu ~ 1 + pa + (1 | nation)
## mod2_u: lezu ~ 1 + pa + na + (1 | nation)
##        npar   AIC   BIC logLik deviance   Chisq Df Pr(&gt;Chisq)    
## mod0_u    3 21868 21889 -10931    21862                          
## mod1_u    4 20453 20480 -10222    20445 1417.51  1  &lt; 2.2e-16 ***
## mod2_u    5 20122 20156 -10056    20112  332.65  1  &lt; 2.2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
</div>
<div id="random-slopes-modelle" class="section level3">
<h3>Random Slopes Modelle</h3>
<p><strong>Level 1</strong>
<span class="math display">\[ y_{ij} = \beta_{0j} + \beta_{1j}x_{1ij} + \beta_{2j}x_{2ij} + r_{ij} \]</span></p>
<p><strong>Level 2</strong>
<span class="math display">\[ \beta_{0j} = \gamma_{00} + u_{0j} \]</span>
<span class="math display">\[ \beta_{1j} = \gamma_{10} + u_{1j} \]</span>
<span class="math display">\[ \beta_{2j} = \gamma_{20} + u_{2j} \]</span></p>
<p><strong>Gesamtgleichung</strong>
<span class="math display">\[ y_{ij} = \gamma_{00} + \gamma_{10}x_{1ij} + \gamma_{20}x_{2ij} + u_{0j} + u_{1j}x_{1ij} + u_{2j}x_{2ij} + r_{ij} \]</span></p>
<pre class="r"><code>mod3 &lt;- lmer(lezu ~ 1 + pa + na + (1 + pa + na | nation), kultur)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl = control$checkConv, :
## Model failed to converge with max|grad| = 0.0166814 (tol = 0.002, component 1)</code></pre>
<ul>
<li>Fehlende Konvergenz des Modells
<ul>
<li>sehr kleine Zufallseffekte</li>
<li>sehr hohe Korrelationen zwischen Zufallseffekten</li>
<li>hohe Modellkomplexität</li>
<li>in jedem Fall: inhaltliche Diagnostik betreiben!</li>
</ul></li>
</ul>
<pre class="r"><code># Optimizer wechseln, langsamer aber Versuch Konvergenz zu erreichen
opts &lt;- lmerControl(optimizer = &#39;bobyqa&#39;)
mod3 &lt;- lmer(lezu ~ 1 + pa + na + (1 + pa + na | nation), kultur, control = opts)</code></pre>
<pre class="r"><code>print(summ(mod3))</code></pre>
<pre><code>## MODEL INFO:
## Observations: 7134
## Dependent Variable: lezu
## Type: Mixed effects linear regression 
## 
## MODEL FIT:
## AIC = 20092.97, BIC = 20161.69
## Pseudo-R² (fixed effects) = 0.21
## Pseudo-R² (total) = 0.35 
## 
## FIXED EFFECTS:
## --------------------------------------------------------
##                      Est.   S.E.   t val.    d.f.      p
## ----------------- ------- ------ -------- ------- ------
## (Intercept)          3.38   0.10    33.31   39.77   0.00
## pa                   0.31   0.01    21.44   37.36   0.00
## na                  -0.18   0.02   -11.26   35.54   0.00
## --------------------------------------------------------
## 
## p values calculated using Satterthwaite d.f.
## 
## RANDOM EFFECTS:
## ------------------------------------
##   Group      Parameter    Std. Dev. 
## ---------- ------------- -----------
##   nation    (Intercept)     0.46    
##   nation        pa          0.07    
##   nation        na          0.08    
##  Residual                   0.97    
## ------------------------------------
## 
## Grouping variables:
## --------------------------
##  Group    # groups   ICC  
## -------- ---------- ------
##  nation      40      0.18 
## --------------------------</code></pre>
<ul>
<li>Gibt leider Korrelationen zwischen REs nicht aus</li>
</ul>
<pre class="r"><code>summary(mod3)$varcor</code></pre>
<pre><code>##  Groups   Name        Std.Dev. Corr         
##  nation   (Intercept) 0.461840              
##           pa          0.068146 -0.201       
##           na          0.078971 -0.545 -0.170
##  Residual             0.972926</code></pre>
</div>
<div id="tests-der-zufallseffekte" class="section level3">
<h3>Tests der Zufallseffekte</h3>
<pre class="r"><code>anova(mod0, mod1) # Fehlermeldung, da Modelle auf den gleichen Datensatz angewandt werden müssen</code></pre>
<pre class="r"><code># Respezifizierung
mod0b &lt;- update(mod0, data = mod1@frame)
mod1b &lt;- update(mod1, data = mod1@frame)

anova(mod0b, mod1b)</code></pre>
<pre><code>## refitting model(s) with ML (instead of REML)</code></pre>
<pre><code>## Data: mod1@frame
## Models:
## mod0b: lezu ~ 1 + (1 | nation)
## mod1b: lezu ~ 1 + pa + (1 | nation)
##       npar   AIC   BIC logLik deviance  Chisq Df Pr(&gt;Chisq)    
## mod0b    3 21888 21909 -10941    21882                         
## mod1b    4 20471 20498 -10231    20463 1419.8  1  &lt; 2.2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>anova(mod2, mod3, refit = FALSE)</code></pre>
<pre><code>## Data: kultur
## Models:
## mod2: lezu ~ 1 + pa + na + (1 | nation)
## mod3: lezu ~ 1 + pa + na + (1 + pa + na | nation)
##      npar   AIC   BIC logLik deviance  Chisq Df Pr(&gt;Chisq)    
## mod2    5 20141 20175 -10065    20131                         
## mod3   10 20093 20162 -10036    20073 57.625  5  3.758e-11 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>confint(mod3)</code></pre>
<pre><code>##                   2.5 %      97.5 %
## .sig01       0.28803189  0.65838445
## .sig02      -0.59999696  0.41636426
## .sig03      -0.81112066 -0.04285697
## .sig04       0.04324943  0.09596252
## .sig05      -0.68676513  0.35625998
## .sig06       0.05101183  0.11042401
## .sigma       0.95705358  0.98925414
## (Intercept)  3.18096518  3.58486611
## pa           0.27964164  0.33677395
## na          -0.21457578 -0.15018436</code></pre>
</div>
<div id="cluster-spezifische-effekte" class="section level3">
<h3>Cluster-spezifische Effekte</h3>
<pre class="r"><code>coef(mod3)</code></pre>
<pre><code>## $nation
##             (Intercept)        pa          na
## Turkey         3.079610 0.3240333 -0.15334430
## Korea          3.035653 0.3134754 -0.18870932
## Slovenia       4.175204 0.2567310 -0.21844953
## Nigeria        2.884775 0.2613936 -0.06944025
## Japan          3.348557 0.3633210 -0.30076732
## Chile          3.532361 0.3643897 -0.15439388
## China          2.598441 0.2457448 -0.12783833
## Thailand       3.244451 0.2347657 -0.15131060
## Australia      3.786806 0.3451125 -0.25063490
## Hong Kong      3.088848 0.3728185 -0.18464822
## Iran           3.025577 0.3631965 -0.20183344
## Greece         3.643417 0.2642850 -0.10955976
## Philippines    3.292683 0.3213365 -0.18554135
## Nepal          2.964937 0.3076754 -0.19683128
## Cyprus         3.678412 0.3042303 -0.18522164
## Indonesia      3.194257 0.3054312 -0.14505948
## Mexico         2.998797 0.3464551 -0.08919093
## Belgium        3.642758 0.3557333 -0.22231390
## Portugal       3.719619 0.3758925 -0.28584232
## Uganda         3.299327 0.2149197 -0.33049564
## Singapore      3.148672 0.3434947 -0.19295717
## Netherlands    3.598533 0.3259991 -0.12747565
## Malaysia       3.580538 0.2726056 -0.12509831
## Georgia        3.061732 0.2409627 -0.17861740
## Croatia        3.657427 0.3363808 -0.24157272
## Ghana          3.676622 0.2090383 -0.19709993
## Bulgaria       3.329737 0.2706614 -0.16330323
## Bangladesh     3.190196 0.3365803 -0.10865147
## Russia         3.444137 0.2978682 -0.14481115
## Slovakia       3.859745 0.2801997 -0.27383117
## Zimbabwe       3.340911 0.2964229 -0.18914434
## Germany        3.826811 0.3333661 -0.21541109
## Kuwait         3.378349 0.3747501 -0.24066920
## Columbia       2.904570 0.4045383 -0.12502992
## Brazil         3.720054 0.3164296 -0.20185942
## Cameroon       2.786755 0.1910104 -0.08125597
## Canada         3.953570 0.3682452 -0.22887852
## India          3.263556 0.2099856 -0.07876195
## S. Africa      3.590768 0.3093365 -0.18161211
## Austria        3.685436 0.3694098 -0.23295960
## 
## attr(,&quot;class&quot;)
## [1] &quot;coef.mer&quot;</code></pre>
<pre class="r"><code>plot_model(mod3, type = &#39;re&#39;, grid = FALSE, sort.est = TRUE)[c(1,3)]</code></pre>
<pre><code>## [[1]]</code></pre>
<p><img src="/post/2023-02-23-KiJu_LMMsQuer_files/figure-html/caterpillar-mod3-1.png" width="672" /></p>
<pre><code>## 
## [[2]]</code></pre>
<p><img src="/post/2023-02-23-KiJu_LMMsQuer_files/figure-html/caterpillar-mod3-2.png" width="672" /></p>
</div>
</div>
<div id="level-2-prädiktoren" class="section level2">
<h2>Level 2 Prädiktoren</h2>
<div id="im-random-intercept-modell" class="section level3">
<h3>Im Random Intercept Modell</h3>
<p><strong>Level 1</strong>
<span class="math display">\[ y_{ij} = \beta_{0j} + \beta_{1j}x_{1ij} + \beta_{2j}x_{2ij} + r_{ij} \]</span></p>
<p><strong>Level 2</strong>
<span class="math display">\[ \beta_{0j} = \gamma_{00} + \gamma_{01} w_{j} + u_{0j} \]</span>
<span class="math display">\[ \beta_{1j} = \gamma_{10} \]</span>
<span class="math display">\[ \beta_{2j} = \gamma_{20} \]</span></p>
<p><strong>Gesamtgleichung</strong>
<span class="math display">\[ y_{ij} = \gamma_{00} + \gamma_{10}x_{1ij} + \gamma_{20}x_{2ij} + \gamma_{01} w_{j} + u_{0j} + r_{ij} \]</span>
- Interpretation der Parameter
* <code>(Intercept)</code> Erwarteter Lebenszufriedenheitswert für Menschen mit 0 positiven Affekt in einem Land mit 0 GDP
* <code>pa</code>/<code>na</code> Unterschied zwischen Personen, die sich um eine Einheit im positiven/negativen Affekt unterscheiden, aber aus Ländern mit gleichem GDP kommen.
* <code>gdp</code> Unterschied zwischen Personen mit gleichem positivem und negativen Affekt die aus Ländern mit 1 GDP Unterschied kommen</p>
<pre class="r"><code>mod4 &lt;- lmer(lezu ~ 1 + pa + na + gdp + (1 | nation), kultur)
print(summ(mod4))</code></pre>
<pre><code>## MODEL INFO:
## Observations: 7134
## Dependent Variable: lezu
## Type: Mixed effects linear regression 
## 
## MODEL FIT:
## AIC = 20120.50, BIC = 20161.74
## Pseudo-R² (fixed effects) = 0.26
## Pseudo-R² (total) = 0.33 
## 
## FIXED EFFECTS:
## ----------------------------------------------------------
##                      Est.   S.E.   t val.      d.f.      p
## ----------------- ------- ------ -------- --------- ------
## (Intercept)          2.08   0.24     8.55     44.68   0.00
## pa                   0.31   0.01    35.70   7116.43   0.00
## na                  -0.18   0.01   -18.45   7128.77   0.00
## gdp                  1.72   0.32     5.45     38.61   0.00
## ----------------------------------------------------------
## 
## p values calculated using Satterthwaite d.f.
## 
## RANDOM EFFECTS:
## ------------------------------------
##   Group      Parameter    Std. Dev. 
## ---------- ------------- -----------
##   nation    (Intercept)     0.32    
##  Residual                   0.98    
## ------------------------------------
## 
## Grouping variables:
## --------------------------
##  Group    # groups   ICC  
## -------- ---------- ------
##  nation      40      0.10 
## --------------------------</code></pre>
</div>
<div id="zentrierung" class="section level3">
<h3>Zentrierung</h3>
<ul>
<li>Effekte der L1 Prädiktoren sind Mischungen aus Individual- und Ländereffekten</li>
<li>Allgemein CWC für die meisten L1 Prädiktoren empfohlen (mehr bei Enders &amp; Tofighi, 2007, und Yaremych et al., 2021)</li>
</ul>
<pre class="r"><code>cwc &lt;- with(kultur, aggregate(cbind(pa, na) ~ nation, FUN = mean))
names(cwc) &lt;- c(&#39;nation&#39;, &#39;pa_mean&#39;, &#39;na_mean&#39;)
kultur_cen &lt;- merge(kultur, cwc, by = &#39;nation&#39;, all.x = TRUE)</code></pre>
<pre class="r"><code>kultur$pa_cwc &lt;- kultur$pa - kultur$pa_mean
kultur$na_cwc &lt;- kultur$na - kultur$na_mean</code></pre>
<ul>
<li>Modellterme verändern sich</li>
</ul>
<pre class="r"><code>mod5 &lt;- lmer(lezu ~ 1 + pa_mean + pa_cwc + na_mean + na_cwc + (1 | nation), kultur)
print(summ(mod5))</code></pre>
<pre><code>## MODEL INFO:
## Observations: 7134
## Dependent Variable: lezu
## Type: Mixed effects linear regression 
## 
## MODEL FIT:
## AIC = 20141.83, BIC = 20189.94
## Pseudo-R² (fixed effects) = 0.27
## Pseudo-R² (total) = 0.38 
## 
## FIXED EFFECTS:
## ----------------------------------------------------------
##                      Est.   S.E.   t val.      d.f.      p
## ----------------- ------- ------ -------- --------- ------
## (Intercept)          1.96   0.86     2.27     36.67   0.03
## pa_mean              0.63   0.12     5.25     36.45   0.00
## pa_cwc               0.31   0.01    35.24   7091.92   0.00
## na_mean             -0.27   0.15    -1.79     37.60   0.08
## na_cwc              -0.18   0.01   -18.42   7091.92   0.00
## ----------------------------------------------------------
## 
## p values calculated using Satterthwaite d.f.
## 
## RANDOM EFFECTS:
## ------------------------------------
##   Group      Parameter    Std. Dev. 
## ---------- ------------- -----------
##   nation    (Intercept)     0.40    
##  Residual                   0.98    
## ------------------------------------
## 
## Grouping variables:
## --------------------------
##  Group    # groups   ICC  
## -------- ---------- ------
##  nation      40      0.14 
## --------------------------</code></pre>
</div>
<div id="cross-level-interaktion" class="section level3">
<h3>Cross-Level Interaktion</h3>
<p><strong>Level 1</strong>
<span class="math display">\[ y_{ij} = \beta_{0j} + \beta_{1j}x_{1ij} + \beta_{2j}x_{2ij} + r_{ij} \]</span></p>
<p><strong>Level 2</strong>
<span class="math display">\[ \beta_{0j} = \gamma_{00} + \gamma_{01} w_{j} + u_{0j} \]</span>
<span class="math display">\[ \beta_{1j} = \gamma_{10} + \gamma_{11} w_{j}  + u_{1j} \]</span>
<span class="math display">\[ \beta_{2j} = \gamma_{20} + \gamma_{21} w_{j}  + u_{2j} \]</span></p>
<p><strong>Gesamtgleichung</strong>
<span class="math display">\[ y_{ij} = \gamma_{00} + \gamma_{10}x_{1ij} + \gamma_{20}x_{2ij} + \gamma_{01} w_{j} + \gamma_{11} w_{j}x_{1ij} + \gamma_{21} w_{j}x_{2ij} + u_{0j} + u_{1j}x_{1ij} + u_{2j}x_{2ij} + r_{ij} \]</span></p>
<table>
<colgroup>
<col width="18%" />
<col width="81%" />
</colgroup>
<thead>
<tr class="header">
<th>Parameter</th>
<th>Bedeutung</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(\gamma_{00}\)</span></td>
<td>Mittleres Intercept</td>
</tr>
<tr class="even">
<td><span class="math inline">\(\gamma_{01}\)</span></td>
<td>Regressionsgewicht des L2-Prädiktors <span class="math inline">\(w_j\)</span> für den Random Intercept</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\gamma_{10}\)</span></td>
<td>Slope des L1-Prädiktors <span class="math inline">\(x_{ij}\)</span> für L2-Einheiten mit <span class="math inline">\(w_j = 0\)</span>, <span class="math inline">\(E(B_1 | W = 0)\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\(\gamma_{11}\)</span></td>
<td>Veränderung von <span class="math inline">\(\hat\beta_{ij}\)</span> pro Einheit des L2-Prädiktors <span class="math inline">\(w_j\)</span></td>
</tr>
<tr class="odd">
<td><span class="math inline">\(u_{0j}\)</span></td>
<td>L2-Residuum bzgl. der Intercepts <span class="math inline">\((\beta_{0j} − \hat\beta_{0j})\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\(u_{1j}\)</span></td>
<td>L2-Residuum bzgl. des Slopes <span class="math inline">\((\beta_{1j} − \hat\beta_{1j})\)</span></td>
</tr>
<tr class="odd">
<td><span class="math inline">\(r_{ij}\)</span></td>
<td>L1-Residuum <span class="math inline">\((y_{ij} − \hat y_{ij})\)</span></td>
</tr>
</tbody>
</table>
<pre class="r"><code>mod6 &lt;- lmer(lezu ~ pa_cwc*gdp + na_cwc*gdp + pa_mean*gdp + na_mean*gdp + (pa_cwc + na_cwc | nation), kultur)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl = control$checkConv, :
## Model failed to converge with max|grad| = 0.00269303 (tol = 0.002, component 1)</code></pre>
<pre class="r"><code>print(summ(mod6))</code></pre>
<pre><code>## MODEL INFO:
## Observations: 7134
## Dependent Variable: lezu
## Type: Mixed effects linear regression 
## 
## MODEL FIT:
## AIC = 20057.76, BIC = 20174.59
## Pseudo-R² (fixed effects) = 0.33
## Pseudo-R² (total) = 0.37 
## 
## FIXED EFFECTS:
## --------------------------------------------------------
##                      Est.   S.E.   t val.    d.f.      p
## ----------------- ------- ------ -------- ------- ------
## (Intercept)         -7.30   2.85    -2.56   35.29   0.01
## pa_cwc               0.15   0.06     2.50   41.71   0.02
## gdp                 12.81   3.96     3.24   36.44   0.00
## na_cwc              -0.03   0.07    -0.48   34.65   0.63
## pa_mean              0.90   0.39     2.33   33.16   0.03
## na_mean              1.53   0.43     3.52   37.08   0.00
## pa_cwc:gdp           0.21   0.08     2.56   42.40   0.01
## gdp:na_cwc          -0.21   0.09    -2.21   35.70   0.03
## gdp:pa_mean         -0.44   0.54    -0.81   34.10   0.42
## gdp:na_mean         -2.39   0.56    -4.27   38.04   0.00
## --------------------------------------------------------
## 
## p values calculated using Satterthwaite d.f.
## 
## RANDOM EFFECTS:
## ------------------------------------
##   Group      Parameter    Std. Dev. 
## ---------- ------------- -----------
##   nation    (Intercept)     0.22    
##   nation      pa_cwc        0.06    
##   nation      na_cwc        0.07    
##  Residual                   0.97    
## ------------------------------------
## 
## Grouping variables:
## --------------------------
##  Group    # groups   ICC  
## -------- ---------- ------
##  nation      40      0.05 
## --------------------------</code></pre>
<pre class="r"><code>plot_model(mod6, &#39;pred&#39;, 
  terms = c(&#39;na_cwc&#39;, &#39;gdp&#39;))</code></pre>
<p><img src="/post/2023-02-23-KiJu_LMMsQuer_files/figure-html/unnamed-chunk-38-1.png" width="672" /></p>
<pre class="r"><code>plot_model(mod6, &#39;est&#39;)</code></pre>
<p><img src="/post/2023-02-23-KiJu_LMMsQuer_files/figure-html/unnamed-chunk-39-1.png" width="672" /></p>
</div>
</div>
